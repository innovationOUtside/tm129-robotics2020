
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5 An example robot program &#8212; TM129 Robotics Practical Activities</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6 Working with simulators" href="01.6%20Working%20With%20Simulators.html" />
    <link rel="prev" title="4 Exploring the nbev3devsim simulator" href="01.4%20Exploring%20nbev3devsim.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      <h1 class="site-logo" id="site-title">TM129 Robotics Practical Activities</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../README_FIRST.html">
   Welcome to the TM129 Robotics block
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../00_FOR_VLE/Section_00_01_Introduction.html">
   1 Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../00_NOTES_FOR_TUTORS/GETTING_STARTED.html">
   Getting started
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="01.1%20Jupyter%20environment.html">
   1 Introduction to the TM129 Jupyter notebook environment
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="01.2%20Exploring%20the%20notebook%20environment.html">
     2 The interactive read-writable notebook environment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01.3%20Introducing%20nbev3devsim.html">
     3 The RoboLab simulated on-screen robot (
     <code class="docutils literal notranslate">
      <span class="pre">
       nbev3devsim
      </span>
     </code>
     )
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01.4%20Exploring%20nbev3devsim.html">
     4 Exploring the
     <code class="docutils literal notranslate">
      <span class="pre">
       nbev3devsim
      </span>
     </code>
     simulator
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     5 An example robot program
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01.6%20Working%20With%20Simulators.html">
     6 Working with simulators
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02.%20Getting%20started%20with%20robot%20and%20Python%20programming/02.1%20Robot%20programming%20constructs.html">
   1 An introduction to programming robots
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02.%20Getting%20started%20with%20robot%20and%20Python%20programming/02.2%20Creating%20your%20own%20robot%20programs.html">
     2 Creating your own robot programs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02.%20Getting%20started%20with%20robot%20and%20Python%20programming/02.3%20General%20programming%20concepts.html">
     3.1 Constants and variables in programs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02.%20Getting%20started%20with%20robot%20and%20Python%20programming/02.4%20Getting%20started%20with%20sensors.html">
     4 Robot sensors and data logging
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.1%20Program%20control%20using%20for%20loops.html">
   1 Introduction to program control flow
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.2%20Program%20control%20using%20while%20loops%20and%20blocking.html">
     2 Program control flow using a
     <code class="docutils literal notranslate">
      <span class="pre">
       while...
      </span>
     </code>
     loop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.3%20Program%20control%20flow%20using%20branches.html">
     3 Branches
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.4%20Example%20robot%20control%20programs.html">
     4 Example robot control programs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.5%20Some%20RoboLab%20challenges.html">
     5 RoboLab challenges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.6%20Optional%20RoboLab%20challenges.html">
     6 Optional challenges
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04.%20Not%20quite%20intelligent%20robots/04.1%20Introducing%20program%20functions.html">
   1 Introduction to functions and robot control strategies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04.%20Not%20quite%20intelligent%20robots/04.2%20Robot%20navigation%20using%20dead%20reckoning.html">
     2 Dead reckoning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04.%20Not%20quite%20intelligent%20robots/04.3%20Emergent%20robot%20behaviour%20and%20simple%20data%20charts.html">
     3 Emergent robot behaviour and simple data charts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04.%20Not%20quite%20intelligent%20robots/04.4%20Reasoning%20with%20Eliza.html">
     4 Reasoning with Eliza
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04.%20Not%20quite%20intelligent%20robots/04.5%20Reasoning%20with%20rule%20based%20systems.html">
     5 Reasoning with rule-based systems – Durable Rules Engine
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05.%20Experimenting%20with%20sensors/05.1%20Introducing%20sensor%20based%20control.html">
   Introduction to sensor-based control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../06.%20Where%20in%20the%20world%20are%20we/06.1%20Introducing%20sensor%20based%20navigation.html">
   Introducing sensor-based navigation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07.%20Neural%20networks/07.1%20Introducing%20neural%20networks.html">
   1 Introducing neural networks
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.1%20Introducing%20remote%20services%20and%20multi-agent%20systems.html">
   1 An introduction to remote services and multi-agent systems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.2%20Collecting%20digit%20image%20and%20class%20data%20from%20the%20simulator.html">
     2 Collecting digit image and class data from the simulator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.3%20Recognising%20digits%20using%20a%20convolutional%20neural%20network%20%28optional%29.html">
     3 Recognising digits using a convolutional neural network (optional)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.4%20Recognising%20patterns%20on%20the%20move.html">
     4 Recognising patterns on the move
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.5%20Messaging%20in%20multi-agent%20systems.html">
     5 Messaging in multi-agent systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.6%20Conclusion.html">
     6 Conclusion
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/01. Introducing notebooks and the RoboLab environment/01.5 Example robot program.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/01. Introducing notebooks and the RoboLab environment/01.5 Example robot program.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#keeping-the-robot-within-an-area">
   5.1 Keeping the robot within an area
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#anatomy-of-the-robolab-stay-inside-program">
   5.2 Anatomy of the RoboLab ‘stay inside’ program
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#activity-simulated-versus-real-world-physical-robots">
     5.2.1 Activity – Simulated versus real-world physical robots
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#example-discussion">
       Example discussion
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-complete-stay-inside-program">
   5.3 The complete ‘stay inside’ program
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-less-magic">
   5.4 Using less magic…
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fixing-the-broken-program">
     5.4.1 Fixing the broken program
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-activity-diffing-the-prepended-code-strings">
     5.4.2 Optional activity – Diffing the prepended code strings
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-the-littlest-simulator-magic-a-complete-python-program">
   5.5 Using the littlest simulator magic: a complete Python program
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-the-magics-to-simplify-our-programs">
   5.6 Using the magics to simplify our programs
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#robots-that-speak">
   5.7 Robots that speak
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   5.8 Summary
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="an-example-robot-program">
<h1>5 An example robot program<a class="headerlink" href="#an-example-robot-program" title="Permalink to this headline">¶</a></h1>
<p>Having now got to grips with the RoboLab environment, it’s time to start looking at what sort of robot control programs we can actually run in the simulator.</p>
<p>In this notebook you will see some example robot control programs in action. At this stage, you do not need to know how to create such programs yourself: the aim of this week’s activities is mainly to familiarise you with RoboLab and the sorts of things we can get the robot to do in the simulator. You will also start to get a feel for the length and complexity of the programs you will be writing for yourself by the end of the robotics block practical activities.</p>
<p>In next week’s activities, we go back to basics with a proper introduction to Python programming, before embarking on some simple robot control programs written using Python code.</p>
<p>So let’s get started and see what sort of things we can get the simulated robot to do…</p>
<p>Remember, you need two things for the <code class="docutils literal notranslate"><span class="pre">%%sim_magic</span></code> to work:</p>
<ul class="simple">
<li><p>first, the magic must be loaded by running the %load_ext nbev3devsim command in a code cell</p></li>
<li><p>second, a code cell <em>must start</em> with %%sim_ETC at the start of a new code cell, followed by the code you want to download starting on a new line in the code cell. If there is a new line or white space or other text before the %%sim_ETC in the code cell, then it won’t work.</p></li>
</ul>
<div class="section" id="keeping-the-robot-within-an-area">
<h2>5.1 Keeping the robot within an area<a class="headerlink" href="#keeping-the-robot-within-an-area" title="Permalink to this headline">¶</a></h2>
<p>Let’s start with an example that shows how to keep a robot inside a particular area bounded by a boxed area marked out on the floor of the world.</p>
<p>You are not expected to understand the program code used to control the robot at this point, although by the end of this block you should be able to write programs of this sort by yourself.</p>
<p>Rather, the aim here is simply to demonstrate some of the features of the simulator and some of the approaches we will be using to try to simplify ways of including ‘boilerplate’ code (that is, particular code elements and definitions we need to include in most of our programs in order write our robot control programs).</p>
<p>Load the simulator package and then load and display the simulator widget:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nbev3devsim.load_nbev3devwidget</span> <span class="kn">import</span> <span class="n">roboSim</span><span class="p">,</span> <span class="n">eds</span>

<span class="o">%</span><span class="n">load_ext</span> <span class="n">nbev3devsim</span>
</pre></div>
</div>
</div>
</div>
<p>Select the <code class="docutils literal notranslate"><span class="pre">Loop</span></code> background which loads the robot in to the centre of a large rectangle drawn with thick black lines, either from the user interface or via a line magic command:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">sim_magic</span> <span class="o">--</span><span class="n">background</span> <span class="n">Loop</span>
</pre></div>
</div>
</div>
</div>
<p>The following ‘stay inside’ program causes the robot to move forwards until its light sensor detects the black contour, at which point the robot reverses direction. When it encounters the contour again it changes direction. In this way the robot shuttles backwards and forwards inside the contour indefinitely.</p>
<p>Run the code cell to download the program to the simulator and resize the widget so you can see the loop background in the simulator.</p>
<p>Click on the simulator <em>Run</em> button, or use the simulator keyboard shortcut (<code class="docutils literal notranslate"><span class="pre">R</span></code>) to run the program in the simulator. When you are ready to stop the program, click on the simulator <em>Stop</em> button.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sim_magic_preloaded</span> <span class="o">--</span><span class="n">background</span> <span class="n">Loop</span> <span class="o">-</span><span class="n">O</span>

<span class="c1"># Program to stay inside a bounded area</span>

<span class="c1"># Start to drive forwards</span>
<span class="n">tank_drive</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

<span class="c1"># Set up a loop to run the set commands</span>
<span class="c1"># over and over again</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># Save the light sensor reading</span>
    <span class="n">light_level</span> <span class="o">=</span> <span class="n">colorLeft</span><span class="o">.</span><span class="n">reflected_light_intensity_pc</span>
    
    <span class="c1"># Display the light sensor value</span>
    <span class="c1"># in the simulator Output display window</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Light_left: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">light_level</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">light_level</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
        <span class="c1"># Drive backwards a set distance </span>
        <span class="n">tank_drive</span><span class="o">.</span><span class="n">on_for_rotations</span><span class="p">(</span><span class="n">SpeedPercent</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">),</span>
                                    <span class="n">SpeedPercent</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">),</span>
                                    <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Drive in a turn for 2 rotations</span>
        <span class="c1"># of the outer motor</span>
        <span class="n">tank_turn</span><span class="o">.</span><span class="n">on_for_rotations</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span>
                                   <span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">75</span><span class="p">),</span>
                                   <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Drive forwards again</span>
        <span class="n">tank_drive</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
                      <span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
        
        <span class="c1"># Last line of if conditional block</span>
        
    <span class="c1"># Last line of while loop block</span>

<span class="c1"># Program ends</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="anatomy-of-the-robolab-stay-inside-program">
<h2>5.2 Anatomy of the RoboLab ‘stay inside’ program<a class="headerlink" href="#anatomy-of-the-robolab-stay-inside-program" title="Permalink to this headline">¶</a></h2>
<p>Having run the ‘stay inside’ program, and observed the behaviour of the robot, let’s now read through the program to see how it works.</p>
<p>If you click in the previous code cell to select it:</p>
<ul class="simple">
<li><p>you can toggle the display of line numbers on and off by repeatedly using the keyboard shortcut <code class="docutils literal notranslate"><span class="pre">Esc-L</span></code></p></li>
<li><p>you can ‘tear off’ the code cell into its own floating widget that you can then refer to by clicking the <code class="docutils literal notranslate"><span class="pre">&gt;_</span></code> notebook toolbar button; click the <code class="docutils literal notranslate"><span class="pre">x</span></code> button in the top right-hand corner of the widget to return the cell to the body of the notebook.</p></li>
</ul>
<p>At the start of the program (line 1) is the cell block <em>IPython magic</em> which is prefixed by two (<code class="docutils literal notranslate"><span class="pre">%%</span></code>) signs. The <code class="docutils literal notranslate"><span class="pre">%%</span></code> prefixed magic is a cell magic that is used to modify the behaviour of the contents of the whole cell.</p>
<p>The magic we are using is the ‘preloaded’ magic with the <code class="docutils literal notranslate"><span class="pre">--background</span></code> switch set to load in the <code class="docutils literal notranslate"><span class="pre">Loop</span></code> background and the <code class="docutils literal notranslate"><span class="pre">-O</span></code> switch to display the <em>Output</em> display panel:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sim_magic_preloaded</span> <span class="o">--</span><span class="n">background</span> <span class="n">Loop</span> <span class="o">-</span><span class="n">O</span>
</pre></div>
</div>
<p>Blank lines, such as lines 2 and 4, have no effect and are used to help make the program more readable.</p>
<p>The next two lines (lines 3 and 5) are comments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Program to stay inside a bounded area</span>

<span class="c1"># Start to drive forwards</span>
</pre></div>
</div>
<p>For these lines, a <code class="docutils literal notranslate"><span class="pre">#</span></code> (‘hash’ or, in American English, a ‘pound’) sign identifies the line as a comment line; in this case, the first line gives a very concise statement of the objective of the program, the second describes what an actual line of code is intended to do.</p>
<p>Comments are ‘free text’ areas that are not executed as lines of Python code. As such, they can be used to provide annotations or explanations of particular parts of the program, or to ‘comment out’ lines of code that are unnecessary.</p>
<p>The control program properly starts by using a ‘tank drive’ command in line 6 to drive the robot forwards at about half its full speed (the left wheel and the right wheel are both powered on at 50% of their maximum speed).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tank_drive</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
</pre></div>
</div>
<p>Another comment, split over lines 8 and 9, prefaces the <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">True:</span></code> loop statement in line 10:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up a loop to run the set commands</span>
<span class="c1"># over and over again</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">True:</span></code> command means <em>repeat everything inside the indented code block below the <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">True:</span></code> command over and over again for ever (or until the user stops the program)</em>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">:</span></code> is <em>required</em> and it defines the entry point into the indented code block if the condition tested by the <code class="docutils literal notranslate"><span class="pre">while</span></code> statement evaluates as <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<p>The next line, line 11, is an indented comment line, and starts the definition of a code block, each line of which will be executed in turn. The lines of code that define the code block, lines 11 to 36, are indented to the same level as the first line of the code block. (Some lines are then followed by their own, further indented, code blocks.) If the condition evaluated by the <code class="docutils literal notranslate"><span class="pre">while</span></code> statement was not true, then the code in the indented code block would not be executed.</p>
<p>Line 12 then defines a named <em>variable</em>, <code class="docutils literal notranslate"><span class="pre">light_level</span></code>, that takes the current numerical value of the <code class="docutils literal notranslate"><span class="pre">colorLeft.reflected_light_intensity_pc</span></code> reflected light sensor reading.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Save the light sensor reading</span>
    <span class="n">light_level</span> <span class="o">=</span> <span class="n">colorLeft</span><span class="o">.</span><span class="n">reflected_light_intensity_pc</span>
</pre></div>
</div>
<p>Lines 14 and 15 are comment lines, followed by a <code class="docutils literal notranslate"><span class="pre">print()</span></code> statement in line 16 that prints the sampled light sensor value as a string to the <em>Output</em> display panel:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Display the light sensor value</span>
    <span class="c1"># in the simulator Output display window</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Light_left: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">light_level</span><span class="p">))</span>
</pre></div>
</div>
<p><em>As you will see later, this value can also be viewed via a dynamically updated chart, as well as analysed ‘offline’ in the Python notebook when the simulation run has finished.</em></p>
<p>The next line in the code block, line 18, is a conditional <code class="docutils literal notranslate"><span class="pre">if</span></code> statement that checks to see if the sampled light sensor reading (<code class="docutils literal notranslate"><span class="pre">light_level</span></code>) is less than (<code class="docutils literal notranslate"><span class="pre">&lt;</span></code>) a specified value (<code class="docutils literal notranslate"><span class="pre">40</span></code>) and sets up the entry point to a code block (<code class="docutils literal notranslate"><span class="pre">:</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="n">light_level</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
</pre></div>
</div>
<p>Following the <code class="docutils literal notranslate"><span class="pre">if</span></code> statement, we start another new code block, with another level of indentation, extending over lines 19 to 34.</p>
<p>If the robot is over the black line, the recorded value for the reflected light value is less than the threshold value and the code in this code block is executed. If the robot is over the white line, a value higher than the threshold is recorded, and on this iteration of the while loop the code in the if block is ignored.</p>
<p>The first line of code in the conditional if block, line 19, is a comment that describes the action of the command split over lines 20 to 22 that drives the robot <em>backwards</em> at half speed for 2 rotations of the wheels:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="c1"># Drive backwards a set distance </span>
        <span class="n">tank_drive</span><span class="o">.</span><span class="n">on_for_rotations</span><span class="p">(</span><span class="n">SpeedPercent</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">),</span>
                                    <span class="n">SpeedPercent</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">),</span>
                                    <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>(According to the <a class="reference external" href="https://python-ev3dev.readthedocs.io/en/ev3dev-stretch/motors.html#ev3dev2.motor.MoveTank.on_for_rotations">documentation</a>, <em>if the left speed is not equal to the right speed (i.e., the robot will turn), the motor on the outside of the turn will rotate for the full rotations while the motor on the inside will have its requested distance calculated according to the expected turn</em>.)</p>
<p>After the robot moves backwards, the comment on lines 24 and 25 describes the action of the command split over lines 26 to 28, which turns the robot on the spot by a specified amount:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="c1"># Drive in a turn for 2 rotations</span>
        <span class="c1"># of the outer motor</span>
        <span class="n">tank_turn</span><span class="o">.</span><span class="n">on_for_rotations</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span>
                                   <span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">75</span><span class="p">),</span>
                                   <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Lines 30 to 32 describe and carry out the action of putting the robot into a ‘free running’ forward driving motion again.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="c1"># Drive forwards again</span>
        <span class="n">tank_drive</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
                      <span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
</pre></div>
</div>
<p>Line 34 is a comment that informally closes the if block (this is not required), and the comment in line 36 optionally and informally announces the end of the while block. Finally, line 38 informally and optionally identifies the end of the program.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="c1"># Last line of if conditional block</span>
        
    <span class="c1"># Last line of while loop block</span>

<span class="c1"># Program ends</span>
</pre></div>
</div>
<p>The control flow initiated by the <code class="docutils literal notranslate"><span class="pre">while</span></code> loop causes the code within the while block to be repeatedly executed. On each iteration of the loop, the light sensor value is polled (sampled) and is tested against the threshold value. If the sensor value is less than the threshold, then the code in the if block is executed, but not otherwise. This means that the robot just drives forwards unless it ‘sees’ the black line, at which point it reverses the direction of the motors, and then turns before driving forwards again. In this way the simulated robot shuttles backwards and forwards, staying inside the area defined by the contour.</p>
<p><em>If you ‘popped out’ the code cell to follow along the reading of program, close the widget it was popped out into now to return the cell to the main body of the notebook.</em></p>
<div class="section" id="activity-simulated-versus-real-world-physical-robots">
<h3>5.2.1 Activity – Simulated versus real-world physical robots<a class="headerlink" href="#activity-simulated-versus-real-world-physical-robots" title="Permalink to this headline">¶</a></h3>
<p>How do you think the way the simulated robot behaved in this activity might compare with the actions of a real robot operating in the physical world?</p>
<p><em>Double-click this cell to edit it and enter your thoughts here, then ‘Run’ this cell to return it to the styled / rendered HTML view.</em></p>
<div class="section" id="example-discussion">
<h4>Example discussion<a class="headerlink" href="#example-discussion" title="Permalink to this headline">¶</a></h4>
<p><em>Click the arrow in the sidebar or run this cell to reveal the example discussion.</em></p>
<p>A simulated robot operates in a purely computational environment and as such operates in a ‘pure’ numerically defined environment.</p>
<p>A real robot may not shuttle backwards and forwards as precisely as the simulated robot does. Real robots are ‘noisy’, but not just in terms of the sound they make. There is also ‘noise’ in their mechanical gearing and control: the motors don’t go at precisely the expected speed, the gears may not mesh perfectly, the wheels may slip or skid, and the sensors do not give instantaneous or perfect readings. All of these mechanical forms of noise may cause the robot to not drive in a perfectly straight line, or it may turn by a slightly different amount on each turn.</p>
<p>The light sensor readings may also be subject to noise. For example, vibration or bumps in the surface may cause the light sensor to bump up or down slightly, changing the height of the light sensor above the surface and changing the amount of reflected light. Shadows or changes in illumination over the extent of the background may also cause false positive identifications of areas cast in shadow as black lines.</p>
<p>In other words, real robots may have sloppy and relatively unpredictable mechanisms so that the same control commands from the same initial position may result in a variety of outcomes. (For this reason, the RoboLab simulator has a noise feature that you will meet later that allows you to set random variations to the motor speeds and sensor readings. This ‘noise’ makes the simulated robot behave more realistically. It will be used in later RoboLab sessions.)</p>
</div>
</div>
</div>
<div class="section" id="the-complete-stay-inside-program">
<h2>5.3 The complete ‘stay inside’ program<a class="headerlink" href="#the-complete-stay-inside-program" title="Permalink to this headline">¶</a></h2>
<p>In the previous program, the <code class="docutils literal notranslate"><span class="pre">tank_drive</span></code> and <code class="docutils literal notranslate"><span class="pre">tank_turn</span></code> elements were predefined by our use of the <code class="docutils literal notranslate"><span class="pre">%%sim_magic_preloaded</span></code> magic. This really is a bit like magic, because it allows us to write Python code that would not ordinarily be valid code. In the background, the magic itself defines some essential Python code that is <em>prepended</em> (that is, added to the start of) our program code before it is downloaded to the simulated robot.</p>
<p>We can see what code is prepended to the code provided in the code cell before it is downloaded to the simulator using the magic as a line magic with the <code class="docutils literal notranslate"><span class="pre">--preview</span></code> switch:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">sim_magic_preloaded</span> <span class="o">--</span><span class="n">preview</span>
</pre></div>
</div>
</div>
</div>
<p>You can also view the full program downloaded to the simulator in the simulator <em>Code display</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">sim_magic</span> <span class="o">-</span><span class="n">WH</span> <span class="o">--</span><span class="n">code</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="using-less-magic">
<h2>5.4 Using less magic…<a class="headerlink" href="#using-less-magic" title="Permalink to this headline">¶</a></h2>
<p>The following code cell uses a slightly less powerful magic, <code class="docutils literal notranslate"><span class="pre">%%sim_magic_imports</span></code>, that still masks some of the complexity in creating a valid Python program although in this case it does require you to define the <code class="docutils literal notranslate"><span class="pre">tank_turn</span></code> and <code class="docutils literal notranslate"><span class="pre">tank_move</span></code> statements in terms of slightly lower-level building blocks. The program in the code cell is intended simply to drive the robot forwards a short way and then stop.</p>
<p>If you download the program and autorun it, then you will hear an error tone and an error message will be displayed in the <em>Output</em> window with a reference to the line number <em>in the complete downloaded program</em> where the error occurred.</p>
<p>You can cross reference the line at fault by looking at the listing <em>in the simulator</em> to see which line <em>in the prepended, downloaded program</em> was at fault.</p>
<p>Note that the corresponding line number <em>in the code cell</em> is <em>not</em> the same line number in the full, downloaded program.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sim_magic_imports</span> <span class="o">--</span><span class="n">background</span> <span class="n">Empty_Map</span> <span class="o">-</span><span class="n">OWHDR</span>

<span class="c1"># Start to drive forwards</span>
<span class="n">tank_drive</span><span class="o">.</span><span class="n">on_for_rotations</span><span class="p">(</span><span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
                            <span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
                            <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If we look at the error, we see it attempts to identify what is at fault and where:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;tank_drive&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span> <span class="n">on</span> <span class="n">line</span> <span class="mi">14</span>
</pre></div>
</div>
<p>Note that program execution stops at the first encountered error. If there were other errors later on in the program, they would not be reported until the program could run through all the previous lines of code without error before encountering the erroneous line.</p>
<p>If we look at the code prepended by the <code class="docutils literal notranslate"><span class="pre">sim_magic_imports</span></code> magic, we see that we have not declared <code class="docutils literal notranslate"><span class="pre">tank_drive</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">sim_magic_imports</span> <span class="o">--</span><span class="n">preview</span>
</pre></div>
</div>
</div>
</div>
<p>If we check the code prepended by the <code class="docutils literal notranslate"><span class="pre">%sim_magic_preloaded</span> <span class="pre">--preview</span></code> magic, we see that the tank controls were defined in that case, along with some predefined sensor elements and some other bits of code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">sim_magic_preloaded</span> <span class="o">--</span><span class="n">preview</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="fixing-the-broken-program">
<h3>5.4.1 Fixing the broken program<a class="headerlink" href="#fixing-the-broken-program" title="Permalink to this headline">¶</a></h3>
<p>To fix the program, we can either revert to the original <code class="docutils literal notranslate"><span class="pre">%%sim_magic_preloaded</span></code> magic or we could ensure that any missing declarations are provided.</p>
<p>The following program should now run correctly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sim_magic_imports</span> <span class="o">--</span><span class="n">background</span> <span class="n">Empty_Map</span> <span class="o">-</span><span class="n">HR</span>

<span class="c1"># Necessary tank_drive definition</span>
<span class="n">tank_drive</span> <span class="o">=</span> <span class="n">MoveTank</span><span class="p">(</span><span class="n">OUTPUT_B</span><span class="p">,</span> <span class="n">OUTPUT_C</span><span class="p">)</span>

<span class="c1"># Start to drive forwards</span>
<span class="n">tank_drive</span><span class="o">.</span><span class="n">on_for_rotations</span><span class="p">(</span><span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
                            <span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
                            <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="optional-activity-diffing-the-prepended-code-strings">
<h3>5.4.2 Optional activity – Diffing the prepended code strings<a class="headerlink" href="#optional-activity-diffing-the-prepended-code-strings" title="Permalink to this headline">¶</a></h3>
<p><em>Click the arrow in the sidebar or run this cell to reveal the optional activity.</em></p>
<p>In many programming environments, a wide range of tools are provided to support code development and debugging. One such tool is known as a ‘differ’ or ‘differencer’ that can be used to highlight differences between two separate files or strings.</p>
<p>Typically, additions in the second file compared to the first are highlighted in green, and deletions from the first file compared to the second are highlighted in red or pink.</p>
<p>In the following code cell, the <code class="docutils literal notranslate"><span class="pre">--previewcode</span></code> switch is applied to the <code class="docutils literal notranslate"><span class="pre">%sim_magic_preloaded</span></code> and <code class="docutils literal notranslate"><span class="pre">%sim_imports</span></code> magics to retrieve the code that each of them prepends. These two strings are then compared and the difference between them displayed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nbcelldiff</span> <span class="kn">import</span> <span class="n">diff_match_patch</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>

<span class="c1"># Create a differencer object</span>
<span class="n">differ</span> <span class="o">=</span> <span class="n">diff_match_patch</span><span class="o">.</span><span class="n">diff_match_patch</span><span class="p">()</span>

<span class="c1"># Load in the code strings appended by the magics</span>
<span class="n">magic_preloaded</span> <span class="o">=</span> <span class="o">%</span><span class="n">sim_magic_preloaded</span> <span class="o">--</span><span class="n">previewcode</span>
<span class="n">magic_imports</span> <span class="o">=</span> <span class="o">%</span><span class="n">sim_magic_imports</span> <span class="o">--</span><span class="n">previewcode</span>

<span class="c1"># Compare the strings and display the difference</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">differ</span><span class="o">.</span><span class="n">diff_main</span><span class="p">(</span><span class="n">magic_imports</span><span class="p">,</span> <span class="n">magic_preloaded</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;br/&gt;&lt;code&gt;&#39;</span><span class="o">+</span><span class="n">differ</span><span class="o">.</span><span class="n">diff_prettyHtml</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&lt;/code&gt;&lt;br/&gt;&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="using-the-littlest-simulator-magic-a-complete-python-program">
<h2>5.5 Using the littlest simulator magic: a complete Python program<a class="headerlink" href="#using-the-littlest-simulator-magic-a-complete-python-program" title="Permalink to this headline">¶</a></h2>
<p>The following code cell shows a fully defined Python program. In this case, a series of ‘package import’ statements appear at the start of the program. Python packages are code libraries written to support particular activities.</p>
<p>The core Python language includes a variety of packages that are distributed as part of the Python language, but additional packages can be written using core Python language elements, <em>or</em> Python commands imported from other additional packages, to build ever more powerful commands.</p>
<p>In particular, the Python <code class="docutils literal notranslate"><span class="pre">ev3dev2</span></code> package provides a range of language constructs that allow us to write a Python program that can work with our <code class="docutils literal notranslate"><span class="pre">nbev3devsim</span></code> simulated robot.</p>
<p><em>The same program should also be runnable on a real Lego EV3 brick running the <code class="docutils literal notranslate"><span class="pre">ev3dev</span></code> operating system.</em></p>
<p>As you can see from the code cell below, which uses the minimal <code class="docutils literal notranslate"><span class="pre">%%sim_magic</span></code> magic to download just the contents of the cell to the simulator, in this case we explicitly <code class="docutils literal notranslate"><span class="pre">import</span></code> the custom elements we need <code class="docutils literal notranslate"><span class="pre">from</span></code> the <code class="docutils literal notranslate"><span class="pre">ev3dev</span></code> Python package that we then make use of in our program.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sim_magic</span> <span class="o">--</span><span class="n">background</span> <span class="n">Empty_Map</span> <span class="o">-</span><span class="n">HR</span>

<span class="c1"># Import required declarations </span>
<span class="c1"># from the ev3dev2.motor package</span>
<span class="kn">from</span> <span class="nn">ev3dev2.motor</span> <span class="kn">import</span> <span class="n">OUTPUT_B</span><span class="p">,</span> <span class="n">OUTPUT_C</span>
<span class="kn">from</span> <span class="nn">ev3dev2.motor</span> <span class="kn">import</span> <span class="n">MoveTank</span><span class="p">,</span> <span class="n">SpeedPercent</span>

<span class="c1"># Necessary tank_drive definition</span>
<span class="n">tank_drive</span> <span class="o">=</span> <span class="n">MoveTank</span><span class="p">(</span><span class="n">OUTPUT_B</span><span class="p">,</span> <span class="n">OUTPUT_C</span><span class="p">)</span>

<span class="c1"># Start to drive forwards</span>
<span class="n">tank_drive</span><span class="o">.</span><span class="n">on_for_rotations</span><span class="p">(</span><span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
                            <span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
                            <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="using-the-magics-to-simplify-our-programs">
<h2>5.6 Using the magics to simplify our programs<a class="headerlink" href="#using-the-magics-to-simplify-our-programs" title="Permalink to this headline">¶</a></h2>
<p>Rather than having to explicitly load in various elements from the <code class="docutils literal notranslate"><span class="pre">ev3dev2</span></code> Python and explicitly define configured motor and sensor elements again and again using <em>boilerplate</em> code (that is, standard code that is the same every time we need to use it), the <code class="docutils literal notranslate"><span class="pre">%%sim_imports</span></code> and <code class="docutils literal notranslate"><span class="pre">%%sim_preloaded</span></code> magics will prepend our programs with necessary boilerplate code on our behalf, simplifying them considerably.</p>
<p>However, you should note that as such it means we can write programs in code cells that are <em>not</em>, in and of themselves, strictly well defined: if we copied and pasted the code directly into the simulator, the program would be lacking essential definitions and would fail to run.</p>
</div>
<div class="section" id="robots-that-speak">
<h2>5.7 Robots that speak<a class="headerlink" href="#robots-that-speak" title="Permalink to this headline">¶</a></h2>
<p>With all that talk of errors and failure, let’s finish this notebook on a more upbeat tone by looking at one more element you may have noticed being preloaded by the <code class="docutils literal notranslate"><span class="pre">%%sim_magic_preloaded</span></code> magic: the <code class="docutils literal notranslate"><span class="pre">say()</span></code> function.</p>
<p>As well as moving about the simulated world, the robot can also affect the state of the world by making a noise in it.</p>
<p>Run the following code cell to download the program to the simulator and autorun it to hear what it has to say for itself…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sim_magic_preloaded</span> <span class="o">-</span><span class="n">HWR</span>
<span class="n">say</span><span class="p">(</span><span class="s2">&quot;Hello. How are you doing today?&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>See if you can modify the name string so that the robot says ‘TM129’. Can you get it to say something that sounds more like <em>tee, em, one, two, nine</em> rather than <em>one hundred and twenty nine</em>?</p>
</div>
<div class="section" id="summary">
<h2>5.8 Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>This notebook started with a demonstration of the sort of behaviour we can program our simulated RoboLab robot to perform inside the simulator – specifically, moving around and staying inside a box. You then saw, line by line, how the program was constructed to perform the task, including: the use of cell magic at the start of the cell to identify the code that followed as code to be downloaded to the simulator; the use of comments in the program code; the use of nested code blocks within loop and conditional statements; and the use of print statements that could report messages to the simulator <em>Output</em> display window.</p>
<p>The simulator itself also uses the <em>Output</em> display window to alert us to errors within our program when we try to run it. In many cases, errors are identified with an associated line number. Using the simulator <em>Code display</em>, you can preview the whole program downloaded to the simulator, not just the explicitly written code in a magicked code cell, along with line numbers to help find the erroneous code line in the context of the complete program around it.</p>
<p>Finally, you also saw how we can use the simulator magics to prepend different amounts of standard boilerplate code to our program before downloading it to the simulator. In particular, the boilerplate code could import several essential packages as well as preconfiguring the motor drives and sensor variables on our behalf and providing us with a means for letting the robot speak for itself.</p>
<p><em>This completes the practical activities for this week.</em> <!-- JD: But there's a notebook after this one, 1.6 Working with simulators, so should this line be replaced with something about reminding students to make notes? Also, above this, should there be a paragraph about what is in the next notebook?  --></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./01. Introducing notebooks and the RoboLab environment"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="01.4%20Exploring%20nbev3devsim.html" title="previous page">4 Exploring the <code class="docutils literal notranslate"><span class="pre">nbev3devsim</span></code> simulator</a>
    <a class='right-next' id="next-link" href="01.6%20Working%20With%20Simulators.html" title="next page">6 Working with simulators</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>