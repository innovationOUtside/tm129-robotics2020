
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3 Some features of RoboLab &#8212; TM129 Robotics Practical Activities  documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="4.1 Activity: Remote control" href="Section_00_04_LEGACY_UNUSED_IGNORE.html" />
    <link rel="prev" title="The ev3devsim Simulator" href="Section_00_02_ev3devsim_simulator_overview.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>from nbev3devsim import ev3devsim_nb as eds
import jp_proxy_widget

#Load the nbtutor extension
%load_ext nbtutor

#https://github.com/AaronWatters/jp_doodle/blob/master/notebooks/misc/JQueryUI%20dialogextend%20plugin%20demo.ipynb
#Load and initialise the jquery.dialogextend package

cdn_url = &quot;https://cdn.jsdelivr.net/npm/binary-com-jquery-dialogextended@1.0.0/jquery.dialogextend.js&quot;
cdn_url = eds.get_file_path(&#39;js/jquery.dialogextend.js&#39;)
module_id = &quot;dialogExtend&quot;

# Load the module using a widget (any widget -- the module loads to the global jQuery object).
loader = jp_proxy_widget.JSProxyWidget()

# Configure the module to be loaded.
loader.require_js(module_id, cdn_url)

# Load the module
loader.js_init(&quot;&quot;&quot;
    element.requirejs([module_identifier], function(module_value) {
        //element.html(&quot;loaded &quot; + module_identifier + &quot; : &quot; + module_value);
    });
&quot;&quot;&quot;, module_identifier=module_id)
loader

</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>from nbev3devsim import ev3devsim_nb as eds

#Reset the notebook style
from IPython.core.display import display, HTML, Javascript

#display(HTML(&quot;&lt;style&gt;#notebook-container { resize:vertical; border: 5px solid;  width: 300px; resize: horizontal; overflow: auto; float:left !important;}&lt;/style&gt;&quot;))
display(HTML(&quot;&lt;style&gt;#notebook-container { width:50%; float:left !important;}&lt;/style&gt;&quot;))

#Launch the simulator
from nbev3devsim import ev3devsim_nb as eds
%reload_ext nbev3devsim

roboSim = eds.Ev3DevWidget()

roboSim.element.dialog();


roboSim.js_init(&quot;&quot;&quot;
element.dialog({ &quot;title&quot; : &quot;Robot Simulator&quot; }).dialogExtend({
        &quot;maximizable&quot; : true,
        &quot;dblclick&quot; : &quot;maximize&quot;,
        &quot;icons&quot; : { &quot;maximize&quot; : &quot;ui-icon-arrow-4-diag&quot; }});
&quot;&quot;&quot;)

display(roboSim)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-javascript notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="nx">javascript</span>
<span class="c1">//This allows us to resize this view</span>
<span class="c1">//Click on the right hand edge to drag</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">&quot;#notebook-container&quot;</span> <span class="p">).</span><span class="nx">resizable</span><span class="p">({</span><span class="nx">ghost</span><span class="o">:</span> <span class="kc">false</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>%load_ext nbtutor
%load_ext nbev3devsim
</pre></div>
</div>
</div>
<div class="section" id="3-Some-features-of-RoboLab">
<h1>3 Some features of RoboLab<a class="headerlink" href="#3-Some-features-of-RoboLab" title="Permalink to this headline">¶</a></h1>
<p>In this section you will run some other RoboLab programs. The purpose is for you to observe what happens, to see some of the features of RoboLab, and to begin to see how other behaviours are controlled by the programs. This section is intended to give you an overview, and you are certainly not expected to remember the details.</p>
<div class="section" id="3.1-Activity:-Keeping-a-robot-in-an-area">
<h2>3.1 Activity: Keeping a robot in an area<a class="headerlink" href="#3.1-Activity:-Keeping-a-robot-in-an-area" title="Permalink to this headline">¶</a></h2>
<p>This activity demonstrates how to keep a robot inside a particular area bounded by a boxed area marked out on the floor of the world.</p>
<p>Load the simulator package and then load and display the simulator widget:</p>
<p>Select the <code class="docutils literal notranslate"><span class="pre">Loop</span></code> background which loads the robot in to the centre of a large rectangle drawn with thick black lines.</p>
<p>The following <code class="docutils literal notranslate"><span class="pre">Stay_inside</span></code> program causes the robot moves forwards until its light sensor detects the black contour, at which point the robot reverses direction. When it encounters the contour again it changes direction. In this way the robot shuttles backwards and forwards inside the contour indefinitely.</p>
<p>Run the code cell to load the program into the simulator, then click on the simulator <em>Run</em> button; hhen you are ready to stop the program, click on the simulator <em>Stop</em> button.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>%%sim_magic_preloaded

# Stay inside
tank_drive.on(SpeedPercent(50), SpeedPercent(50))

while True:
    print(&#39;Light_left: &#39; + str(colorLeft.reflected_light_intensity))
    if colorLeft.reflected_light_intensity &lt; 40:
        tank_drive.on_for_rotations(SpeedPercent(-50), SpeedPercent(-50), 2)
        # drive in a turn for 2 rotations of the outer motor
        tank_turn.on_for_rotations(-100, SpeedPercent(75), 2)
        tank_drive.on(SpeedPercent(50), SpeedPercent(50))
</pre></div>
</div>
</div>
<p>At the start of the program, a <code class="docutils literal notranslate"><span class="pre">#</span></code> sign identifies the line as a comment line, in this case giving a very concise statement of the objective of the programme. Comments are “free text” areas that are not exeucted as lines of Python code. As such, they can be used to provide annotations or explanations of particular parts of the programme, or “comment out” lines of code that are unnecessary.</p>
<p>The program starts by using a “tank drive” to drive the robot forwards at about half it’s full speed (the left wheel and the right wheen are both powered on at 50% of their maximum speed).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">True:</span></code> command means <em>do everything that follows for ever (or until the user stops the program)</em>. The <code class="docutils literal notranslate"><span class="pre">:</span></code> is <em>required</em> and it defines what to do if the tested condition evaluates as true.</p>
<p>The next line is indented, and starts the definition of a code block, each line of which will be executed in turn. The lines of code that define the code block are indented to the same level. If the condition evaulated by the <code class="docutils literal notranslate"><span class="pre">while</span></code> statement was not true, then the code block would not be executed.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">print('Light_left:</span> <span class="pre">'</span> <span class="pre">+</span> <span class="pre">str(colorLeft.reflected_light_intensity))</span></code> command prints the current value of the left light sensor, which is reading the “reflected light intensity” to the output display window. As you will see later, this value can also be viewed via a dynamically updated chart, as well as analysed “offline” in the Python notebook when the simulation run has finished.</p>
<p>The next line in the code block, <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">colorLeft.reflected_light_intensity</span> <span class="pre">&lt;</span> <span class="pre">40:</span></code>, compares a specific sensor reading, interpreted in a particular way, to a particular value (100). If the value is below that threshold, as it is when the robot is over the black like, the programme moves on to a new code block defined by lines of code that are further indented.</p>
<p>On the first line of code in that new code block, the robot drives <em>backwards</em> at half speed for 2 rotations of the wheels (<code class="docutils literal notranslate"><span class="pre">tank_drive.on_for_rotations(SpeedPercent(-50),</span> <span class="pre">SpeedPercent(-50),</span> <span class="pre">2)</span></code>). (According to the <a class="reference external" href="https://python-ev3dev.readthedocs.io/en/ev3dev-stretch/motors.html#ev3dev2.motor.MoveTank.on_for_rotations">documentation</a>, <em>if the left speed is not equal to the right speed (i.e., the robot will turn), the motor on the outside of the turn will rotate for the full rotations
while the motor on the inside will have its requested distance calculated according to the expected turn</em>).</p>
<p>After the robot moves backwards, there is a comment line suggesting what the next executed line of code does (<code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">drive</span> <span class="pre">in</span> <span class="pre">a</span> <span class="pre">turn</span> <span class="pre">for</span> <span class="pre">2</span> <span class="pre">rotations</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">outer</span> <span class="pre">motor</span></code>) and then the robot turns on the spot (<code class="docutils literal notranslate"><span class="pre">tank_turn.on_for_rotations(-100,</span> <span class="pre">SpeedPercent(75),</span> <span class="pre">2)</span></code>).</p>
<p>Finally, the robot is set to drive forwards again (<code class="docutils literal notranslate"><span class="pre">tank_drive.on(SpeedPercent(50),</span> <span class="pre">SpeedPercent(50))</span></code>) and the sequence is repeated, with the programme control flow looping back to the while statement and then working through each step in turn again. While the sensor reading is above 100, the robot keeps going. Every time it “sees” the black contour it reverses the direction of the motors, and then turns ebfore driving forwards again. In this way the simulated robot shuttles backwards and
forwards, staying inside the area defined by the contour.</p>
<p>How do you think the simulated robot in this activity compares with a real robot?</p>
<div class="section" id="Viewing-the-stay-inside-test-on-a-real-robot">
<h3>Viewing the stay inside test on a real robot<a class="headerlink" href="#Viewing-the-stay-inside-test-on-a-real-robot" title="Permalink to this headline">¶</a></h3>
<div class="alert-danger"><p>TO DO: the programmes should work on an EV3 running <code class="docutils literal notranslate"><span class="pre">`python-ev3dev</span></code> &lt;<a class="reference external" href="https://python-ev3dev.readthedocs.io/">https://python-ev3dev.readthedocs.io/</a>&gt;`__. A <a class="reference external" href="https://github.com/ev3dev/vscode-ev3dev-browser">Visual Studio Code extension for browsing ev3dev devices</a> seems to provide an environment for running the <code class="docutils literal notranslate"><span class="pre">python-ev3dev</span></code> code on a real robot which is perhaps something worth exploring. <em>Note that VS Code can also run notebooks, although I’m not sure if the simulation widget will run in that environment.</em></p>
</div><p>The following video clip shows a simple Lego robot executing the <code class="docutils literal notranslate"><span class="pre">Stay_inside</span></code> program discussed above. You will notice that the real robot does not shuttle backwards and forwards as precisely as the simulated robot. Real robots are ‘noisy’, but not just in terms of the sound they make. There is also ‘noise’ in their mechanical gearing and control: the motors don’t go at precisely the expected speed, the gears may not mesh perfectly, the wheels may slip or skid, and the sensors do not give
instantaneous or perfect readings.</p>
<p>In other words, real robots may have sloppy and relatively unpredictable mechanisms so that the same control commands from the same initial position may result in a variety of outcomes. For this reason, the RobotLab simulator has a noise feature that allows you to set random variations to the motor speeds and sensor readings. This ‘noise’ makes the simulated robot behave more realistically. It will be used in later Robot Lab sessions.</p>
</div>
</div>
<div class="section" id="Using-Less-Magic…">
<h2>Using Less Magic…<a class="headerlink" href="#Using-Less-Magic…" title="Permalink to this headline">¶</a></h2>
<p>In the previous program, the <code class="docutils literal notranslate"><span class="pre">tank_drive</span></code> and <code class="docutils literal notranslate"><span class="pre">tank_turn</span></code> elements are predefined by our use of the <code class="docutils literal notranslate"><span class="pre">%%sim_magic_preloaded</span></code> magic. This really is a bit like magic, because it allows us to write Python code that would not ordinarliy be valid code. The magic itself defines some essential Python code that is <em>prepended</em> (that is, added to the start of) out programme code before it is downloaded to the simulated robot.</p>
<p>The following code cell uses a slightly less powerful magic, <code class="docutils literal notranslate"><span class="pre">%%sim_magic_imports</span></code>, that still masks some of the complexity in creating a valid Python programme although in this case it does require you to define the <code class="docutils literal notranslate"><span class="pre">tank_turn</span></code> and <code class="docutils literal notranslate"><span class="pre">tank_move</span></code> statements in turns of slightly lower level building blocks.</p>
<p>As with the <code class="docutils literal notranslate"><span class="pre">Move_a_robot</span></code> programme, the <code class="docutils literal notranslate"><span class="pre">MoveSteering</span></code> and <code class="docutils literal notranslate"><span class="pre">MoveTank</span></code> commands are commands provided the <code class="docutils literal notranslate"><span class="pre">ev3dev</span></code> Python package and then configured to use particular outputs on the (simulated) robot (<code class="docutils literal notranslate"><span class="pre">OUTPUT_B</span></code> and <code class="docutils literal notranslate"><span class="pre">OUTPUT_C</span></code>).</p>
<p>In addition, the light sensor is defined using the <code class="docutils literal notranslate"><span class="pre">ColorSensor</span></code> command to confgure the sensor attached to <code class="docutils literal notranslate"><span class="pre">INPUT_2</span></code> as a colour sensor. The light sensor is shown as small white circle contained within a grey square on the simulated robot.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>%%sim_magic_imports

# Stay inside
tank_turn = MoveSteering(OUTPUT_B, OUTPUT_C)
tank_drive = MoveTank(OUTPUT_B, OUTPUT_C)

colorLeft = ColorSensor(INPUT_2)

tank_drive.on(SpeedPercent(50), SpeedPercent(50))

while True:
    print(&#39;Light_left: &#39; + str(colorLeft.reflected_light_intensity))
    if colorLeft.reflected_light_intensity &lt; 40:
        tank_drive.on_for_rotations(SpeedPercent(-50), SpeedPercent(-50), 2)
        # drive in a turn for 2 rotations of the outer motor
        tank_turn.on_for_rotations(-100, SpeedPercent(75), 2)
        tank_drive.on(SpeedPercent(50), SpeedPercent(50))
</pre></div>
</div>
</div>
</div>
<div class="section" id="A-Complete-Python-Programme">
<h2>A Complete Python Programme<a class="headerlink" href="#A-Complete-Python-Programme" title="Permalink to this headline">¶</a></h2>
<p>The following code cell shows a fully defined Pyhton program. In this case, a series of “package import” statements appear at the start of the programme. Python packages are code libraries written to support particular activities.</p>
<p>The core Python language includes a variety of packages that are distributed as part of the Python language, but additional packages can be written using core Python langauge elements, <em>or</em> Python commands imported from other additional packages, to build every moe powerful commands.</p>
<p>In particular, the Python <code class="docutils literal notranslate"><span class="pre">ev3dev</span></code> package provides a range of language constructs that allow us to write a Python programme that can work with a Lego EV3 brick running the <code class="docutils literal notranslate"><span class="pre">ev3dev</span></code> operating system, or our <code class="docutils literal notranslate"><span class="pre">nbev3devsim</span></code> simulated robot.</p>
<p>As you can see from the code cell below, which uses the minimal <code class="docutils literal notranslate"><span class="pre">%%sim_magic</span></code> magic to download just the contents of the cell to the simulator, in this case we <code class="docutils literal notranslate"><span class="pre">import</span></code> the custom elements we need <code class="docutils literal notranslate"><span class="pre">from</span></code> the <code class="docutils literal notranslate"><span class="pre">ev3dev</span></code> Python package that we then make use of in our programme.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>%%sim_magic

# Stay inside
from ev3dev2.motor import MoveTank, MoveSteering, SpeedPercent, OUTPUT_B, OUTPUT_C
from ev3dev2.sensor import INPUT_1, INPUT_2, INPUT_3, INPUT_4
from ev3dev2.sensor.lego import ColorSensor

tank_turn = MoveSteering(OUTPUT_B, OUTPUT_C)
tank_drive = MoveTank(OUTPUT_B, OUTPUT_C)
colorLeft = ColorSensor(INPUT_2)

tank_drive.on(SpeedPercent(50), SpeedPercent(50))

while True:
    print(&#39;Light_left: &#39; + str(colorLeft.reflected_light_intensity))
    if colorLeft.reflected_light_intensity &lt; 40:
        tank_drive.on_for_rotations(SpeedPercent(-50), SpeedPercent(-50), 2)
        # drive in a turn for 2 rotations of the outer motor
        tank_turn.on_for_rotations(-100, SpeedPercent(75), 2)
        tank_drive.on(SpeedPercent(50), SpeedPercent(50))
</pre></div>
</div>
</div>
</div>
<div class="section" id="3.2-Activity:-Investigating-sensors">
<h2>3.2 Activity: Investigating sensors<a class="headerlink" href="#3.2-Activity:-Investigating-sensors" title="Permalink to this headline">¶</a></h2>
<p>In this activity you will experiment with a light sensor.</p>
<div class="alert-success"><p>To make it easier to see what’s going on, click on the code cell that is used to display the simulator and use the notebook toolbar up/down arrows to move the cell down to this part of the notebook, closer to the code cells we will be using to download new programmes into the simulator.</p>
</div><div class="alert-warning"><p>We need to think about making a more workable UI, within the constraints of limited time and skill available to spend on that issue right now… Which is to say, suggestions are welcome, but without PRs, they may may well <code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">/dev/null</span></code>…</p>
</div><p>This is similar to the Lego light sensor:</p>
<p>TO DO image: <em>A Lego light sensor. This is a blue Lego brick, 4 x 2 studs in size with a wire emerging from one end. At the other end, two small lenses are visible. One is clear – this is the light sensor itself. Next to it is a red LED which can be used as a light source to illuminate a surface so that the sensor measures light reflected from the surface rather than ambient light levels.</em></p>
<p>In the simulator, load in the <em>Grey bands</em> backgorund, which displays a white background overlaid by four grey bars of different in intensity, ranging from a pale grey to black.</p>
<p>The simulated robot drives over the background, logging the light sensor data as it does so.</p>
<p>Here’s the complete programme:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>%%sim_magic
# Sensor_sim
from ev3dev2.motor import MoveTank, SpeedPercent, OUTPUT_B, OUTPUT_C
from ev3dev2.sensor import INPUT_1, INPUT_2, INPUT_3, INPUT_4
from ev3dev2.sensor.lego import ColorSensor


tank_drive = MoveTank(OUTPUT_B, OUTPUT_C)
colorLeft = ColorSensor(INPUT_2)

tank_drive.on(SpeedPercent(50), SpeedPercent(50))

while True:
    print(&#39;Colour: &#39; + str(colorLeft.reflected_light_intensity ))
</pre></div>
</div>
</div>
<p>We can also use the <code class="docutils literal notranslate"><span class="pre">%%sim_magic_preloaded</span> <span class="pre">SIMULATOR</span></code> magic to preload the drive and sensor configurations and references to minimise the clutter in <em>our</em> code, whilst remembering that it is still required for the programme to run, and will be loaded in automatically by the magic:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>%%sim_magic_preloaded
# Sensor_sim preloaded

tank_drive.on(SpeedPercent(50), SpeedPercent(50))

while True:
    print(&#39;Colour: &#39; + str(colorLeft.reflected_light_intensity ))
</pre></div>
</div>
</div>
<p>Download either variant of the program to the simulator and run it, stopping the programme when the robot has gone passed the final black line.</p>
<p>As the programme runs, you should notice that that a sequence of logged data values from the sensor are displayed in the output window. If you scroll up through the display in that window you should notice that the sensor values changed as the robot crossed over each grey line.</p>
<div class="section" id="SAQ-TO-DO">
<h3>SAQ TO DO<a class="headerlink" href="#SAQ-TO-DO" title="Permalink to this headline">¶</a></h3>
<p>What value does the sensor give when the robot is placed on the white background? What sensor values are returned for when the light sensor is over the light grey, medium grey, dark grey and black bands?</p>
<p>Do you notice anything strange about the sensor values, particularly when the robot encounters or leaves a particular band?</p>
<div class="section" id="Answer">
<h4>Answer<a class="headerlink" href="#Answer" title="Permalink to this headline">¶</a></h4>
<p><em>Click the arrow in the sidebar to reveal the answer.</em></p>
<p>I get the following readings for the reflected light intensity readings from the light sensor:</p>
<ul class="simple">
<li><p>white background: <code class="docutils literal notranslate"><span class="pre">100</span></code></p></li>
<li><p>light grey band: <code class="docutils literal notranslate"><span class="pre">~86</span></code></p></li>
<li><p>medium grey band: <code class="docutils literal notranslate"><span class="pre">~82</span></code></p></li>
<li><p>dark grey band: <code class="docutils literal notranslate"><span class="pre">~50</span></code></p></li>
<li><p>black band: <code class="docutils literal notranslate"><span class="pre">0</span></code></p></li>
</ul>
<p>There is some “noise” in the form of intermediate values as the robot goes into and leaves the band. This is because the sensor has a “width” so it may be averaging readings where part of the sensor is over the white background and part of it is over the coloured band.</p>
</div>
</div>
</div>
<div class="section" id="Activity---Viewing-the-Logged-Data---The-Simulator-Datalog-Chart-Display">
<h2>Activity - Viewing the Logged Data - The Simulator Datalog Chart Display<a class="headerlink" href="#Activity---Viewing-the-Logged-Data---The-Simulator-Datalog-Chart-Display" title="Permalink to this headline">¶</a></h2>
<p>As well as displaying the logged data values using the output display, the print messages are parsed and used to extract data values so that they can be displayed on a dynamically updated line chart.</p>
<p>Enable the data charter by clicking the <em>Show chart</em> check box in the simulator and then check the <em>Colour</em> trace checkbox.</p>
<p><em>TO DO - need a better way to set and handle traces?</em></p>
<p>Reset the start location of the robot either by dragging it back to the start or clicking the <em>Move</em> button to reset the original location for the current simulator setup.</p>
<p>Run the simulator programme again until the robot has crossed over all the lines, observing how the chart is updated with the live sensor values. Can you see where the robot encounters the different coloured bands? What values are recorded for each band?</p>
<p>From the chart, can you read off the values for each band?</p>
<div class="section" id="id1">
<h3>Answer<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p><em>Click the arrow in the sidebar to reveal the answer.</em></p>
<p>The following diagram shows the result of showing the real time data logging chart:</p>
<p>As the robot progresses across the bands, the bars that it encounters get progressively darker, so the sensor readings reduce. Between the bands, as the robot crosses the white background, the sensor reading go back up to their initial, maximum reading.</p>
<p>If you hover your cursor over the chart, all the recorded trace values at that x-position on the chart are displayed. These are the values that were recorded and displayed, taken from the midpoint of the chart, when I ran the experiment.</p>
<ul class="simple">
<li><p>white background: <code class="docutils literal notranslate"><span class="pre">100</span></code></p></li>
<li><p>light grey band: <code class="docutils literal notranslate"><span class="pre">86.27451</span></code></p></li>
<li><p>medium grey band: <code class="docutils literal notranslate"><span class="pre">82.7451</span></code></p></li>
<li><p>dark grey band: <code class="docutils literal notranslate"><span class="pre">50.19608</span></code></p></li>
<li><p>black band: <code class="docutils literal notranslate"><span class="pre">0</span></code></p></li>
</ul>
<p><em>(You may have noticed that the simulation running in a slightly more “stuttery” way than when the chart is not displayed as your computer has to do more work in terms of dynamically updating the chart.)</em></p>
<p><em>TO DO - I think the chart may also be checking all the sensor values and perhaps forcing them to be calculated? Need to optimise this to only calculate and plot values that are actually being logged.</em></p>
<p><em>TO DO - should we experiment with generating text descriptions of charts, eg as per</em><a class="reference external" href="https://blog.ouseful.info/2016/04/29/first-thoughts-on-automatically-generating-accessible-text-descriptions-of-ggplot-charts-in-r/">Automatically Generating Accessible Text Descriptions of Charts</a><em>?</em></p>
</div>
</div>
<div class="section" id="Viewing-the-Logged-Data---Uploading-the-Logged-Data-to-the-Notebook">
<h2>Viewing the Logged Data - Uploading the Logged Data to the Notebook<a class="headerlink" href="#Viewing-the-Logged-Data---Uploading-the-Logged-Data-to-the-Notebook" title="Permalink to this headline">¶</a></h2>
<p>As well as inspecting the data log values in the simulator output window and via the embedded datalog chart, we can also export the logged data from the simulator into the Python enviornment used by the notebook. This then allows us to analyse and chart the data within a complete Python environment.</p>
<p><em>TO DO - should we have some magic to get data out of the datalog?</em></p>
<p>The following code cell shows how to access the datalog from the simulator in the notebook’s Python environment. The <em>pandas</em> package is a very powerful package for working with tabular data.</p>
<p><em>You can learn more about using pandas from the OpenLearn unit</em><a class="reference external" href="https://www.open.edu/openlearn/science-maths-technology/learn-code-data-analysis/content-section-overview-0?active-tab=description-tab">“Learn To Code For Data Analysis”</a><em>or as part of the Open University module</em><a class="reference external" href="http://www.open.ac.uk/courses/modules/tm351">Data management and analysis (TM351)</a><em>.</em></p>
<p>Run the following code cell to grab the data from the datalog as a tabular dataset and preview the first few rows from it:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>#roboSim.results_log
import pandas as pd

def get_dataframe_from_datalog(datalog):
    &quot;&quot;&quot;Generate a datafrome from simulator datalog.&quot;&quot;&quot;
    df = pd.DataFrame(datalog)
    if not df.empty:
        df = df.melt(id_vars=&#39;index&#39;).dropna()
        df[&#39;index&#39;] = pd.to_timedelta(df[&#39;index&#39;]-df[&#39;index&#39;].min())
    return df

#Grab the logged data into a pandas dataframe
df = get_dataframe_from_datalog(roboSim.results_log)

#Preview the first few rows of the dataset
df.head()
</pre></div>
</div>
</div>
<p>With the data in a <em>pandas</em> dataframe, we can then use a variety of tools to generate our own charts from it.</p>
<p>One approach is to use the <em>seaborn</em> Python package to create a line chart directly from the dataframe.</p>
<p>By convention, <em>seaborn</em> is loaded in and referred to as <code class="docutils literal notranslate"><span class="pre">sns</span></code>. The line plot charting function is selected (<code class="docutils literal notranslate"><span class="pre">sns.lineplot()</span></code>) and passed the dataframe (<code class="docutils literal notranslate"><span class="pre">data=df</span></code>). The <em>index</em> column values in the dataframe are assigned to the <em>x</em>-axis (<code class="docutils literal notranslate"><span class="pre">x=&quot;index&quot;</span></code>) and the <em>value</em> column values to the <em>y</em>-axis (<code class="docutils literal notranslate"><span class="pre">y=&quot;value&quot;</span></code>). The line colour is generated from unique values identified in the <em>variable</em> column (<code class="docutils literal notranslate"><span class="pre">hue='variable'</span></code>).</p>
<p>If we had additional sensors identified using different <em>variable</em> values, such as <em>ultrasonic</em>, each sensor would have it’s own coloured line trace.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>import seaborn as sns
ax = sns.lineplot(x=&quot;index&quot;, y=&quot;value&quot;, hue=&#39;variable&#39;, data=df)
</pre></div>
</div>
</div>
<p>Note that in passing parameter values to the <code class="docutils literal notranslate"><span class="pre">lineplot()</span></code> function, we can use either single or double quotes to identify the column name as a string value. So for example, both <code class="docutils literal notranslate"><span class="pre">hue='variable'</span></code>, using single quotes (<code class="docutils literal notranslate"><span class="pre">'</span></code>) and <code class="docutils literal notranslate"><span class="pre">hue=&quot;variable&quot;</span></code>, using double quotes (<code class="docutils literal notranslate"><span class="pre">&quot;</span></code>), are equally valid.</p>
<p>As well generating charts using just the <em>seaborn</em> package, we can build up charts from several layers of data display. The following chart is constructed from a seaborn <code class="docutils literal notranslate"><span class="pre">FacetGrid</span></code> chart, which generates one line chart per sensor (as identifed from the <code class="docutils literal notranslate"><span class="pre">row=&quot;variable&quot;</span></code> parameter), and then overplots individual <code class="docutils literal notranslate"><span class="pre">x</span></code> markers, one per datapoint, using the a <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> plotting function.</p>
<div class="alert-warning"><p>matplotlib is a relatively low level charting library that gives us more control over simple items that make up a chart. The seaborn package is itself built up from simpler matplotlib components.</p>
</div><div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>import matplotlib.pyplot as plt

g = sns.FacetGrid(df, row=&quot;variable&quot;, height=5, aspect=2, sharey=False)
g = g.map(plt.plot, &quot;index&quot;, &quot;value&quot;, marker=&quot;x&quot;);
</pre></div>
</div>
</div>
<p>Starting from the left-hand side, each blue <code class="docutils literal notranslate"><span class="pre">x</span></code> point represents a sensor reading. The white background in the grey bars environment shows as 100 and the solid black line shows as 0.</p>
<p>TO DO - how do we clear the datalog [<a class="reference external" href="https://github.com/innovationOUtside/nbev3devsim/issues/7">related issue</a>]:</p>
<ul class="simple">
<li><p>just on the py side?</p></li>
<li><p>on the py side and the js side just from the py side?</p></li>
<li><p>just on the js side from the simulator?</p></li>
<li><p>on both js and py side from the simulator?</p></li>
</ul>
</div>
<div class="section" id="Robots-that-speak">
<h2>Robots that speak<a class="headerlink" href="#Robots-that-speak" title="Permalink to this headline">¶</a></h2>
<p>As well as moving about the simulated world, the robot can also affect the state of the world by making a noise it. In particular, we can get the robot to speak by using a function from the <code class="docutils literal notranslate"><span class="pre">playsound</span></code> package (created as a custom package for use in this module in the javascript Skulpt/Pyhton environment): <code class="docutils literal notranslate"><span class="pre">playsound.say()</span></code>.</p>
<p>Run the following code cell to download the programme to simulator and then run it in the simulator. Does it say hello?!</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>%%sim_magic
# Say hello
import playsound

your_name = &quot;TM129 student&quot;
playsound.say(&quot;Hello there,&quot; + your_name)
</pre></div>
</div>
</div>
<p>See if you can modify the name string so that the robot says something that sounds more like <em>tee, em, one, two, nine</em> rather than <em>one hundred and twenty nine</em>. Run the modified code cell to download the programme to the simulator, and then run the programme there to test it.</p>
<p>Can you also get the robot to say hello to you using your own personal name?</p>
</div>
<div class="section" id="Robots-That-Count">
<h2>Robots That Count<a class="headerlink" href="#Robots-That-Count" title="Permalink to this headline">¶</a></h2>
<p>That’s a good start to gettig the robot to speak, but can we do something more elaborate?</p>
<p>How about counting up from 1 to 5?</p>
<p>The Python <code class="docutils literal notranslate"><span class="pre">range()</span></code> function can be used to generate a iterator over a series of integers that cover a certain range:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>range(5)
</pre></div>
</div>
</div>
<p>We can use a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop to iterate through the range, displaying each value within the range using a <code class="docutils literal notranslate"><span class="pre">print()</span></code> statement:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>for i in range(5):
    print(i)
</pre></div>
</div>
</div>
<p>We can also inspect the values by casting the range interator to a list:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>list(range(0,5))
</pre></div>
</div>
</div>
<p>If we supply just a single value to the <code class="docutils literal notranslate"><span class="pre">range()</span></code> function, as in <code class="docutils literal notranslate"><span class="pre">range(N)</span></code>, it defines a range that spans from <span class="math notranslate nohighlight">\(0\)</span> to <span class="math notranslate nohighlight">\(N-1\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>M = 5

list(range(M))
</pre></div>
</div>
</div>
<p>If we provide two arguments, <code class="docutils literal notranslate"><span class="pre">range(M,</span> <span class="pre">N)</span></code>, it defines a range from <span class="math notranslate nohighlight">\(M\)</span> to <span class="math notranslate nohighlight">\(N-1\)</span>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>M = 5
N = 10

list(range(M, N))
</pre></div>
</div>
</div>
<p>If we provide <em>three</em> arguments, <code class="docutils literal notranslate"><span class="pre">range(M,</span> <span class="pre">N,</span> <span class="pre">S)</span></code>, it spans a range of integeres from <span class="math notranslate nohighlight">\(M\)</span> to <span class="math notranslate nohighlight">\(N-1\)</span> with a step value <span class="math notranslate nohighlight">\(S\)</span> between them:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>M = 0
N = 30
S = 10

list(range(M, N, S))
</pre></div>
</div>
</div>
<p>If we set <span class="math notranslate nohighlight">\(M=0\)</span>, <span class="math notranslate nohighlight">\(N=30\)</span> and <span class="math notranslate nohighlight">\(S=10\)</span>, the first value returned from the range is the intial start value, <span class="math notranslate nohighlight">\(0\)</span>.</p>
<p>We then add a step of <span class="math notranslate nohighlight">\(10\)</span> to get the next value (<span class="math notranslate nohighlight">\(10\)</span>).</p>
<p>Adding another step of <span class="math notranslate nohighlight">\(10\)</span> gives us the next number in the range: <span class="math notranslate nohighlight">\(20\)</span>.</p>
<p>If we now try to add another <span class="math notranslate nohighlight">\(10\)</span>, that gives us a total of <span class="math notranslate nohighlight">\(30\)</span>, which is <em>outside</em> the upper range of <span class="math notranslate nohighlight">\(N-1\)</span>, and so that number os not returned as within the range.</p>
<p>Now let’s see if we can get our robot to count up to five in the simulator.</p>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">playsound.say()</span></code> function accepts a <em>string</em> value, so if we want it to speak a number aloud we must first cast it to a string; for example, <code class="docutils literal notranslate"><span class="pre">str(5)</span></code>.</p>
<p><em>TO DO: maybe define a “say_number()” function? Or may say more robust and error trap / cast non-strings to string values?</em><a class="reference external" href="https://github.com/innovationOUtside/nbev3devsim/issues/37">Related issue</a><em>.</em></p>
<p>Run the following code cell to download the programme to the simulator and then run it in the simulator. What happens? Does the robot count up to five?</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>%%sim_magic
# I can count...
import playsound

for i in range(5):
    playsound.say(str(i))
</pre></div>
</div>
</div>
<p>Although we set the range value as <span class="math notranslate nohighlight">\(5\)</span>, remember that ths means the robot will count, by default, from <span class="math notranslate nohighlight">\(0\)</span> in steps of <span class="math notranslate nohighlight">\(1\)</span> to <span class="math notranslate nohighlight">\(N-1\)</span>. So the robot will count <span class="math notranslate nohighlight">\(0, 1, 2, 3, 4\)</span>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>list(range(5))
</pre></div>
</div>
</div>
<div class="section" id="Activity-TO-DO">
<h3>Activity TO DO<a class="headerlink" href="#Activity-TO-DO" title="Permalink to this headline">¶</a></h3>
<p>In the following code cell, create a <code class="docutils literal notranslate"><span class="pre">range()</span></code> statement that will creates a list of numbers from <span class="math notranslate nohighlight">\(1\)</span> to <span class="math notranslate nohighlight">\(5\)</span> inclusive. Use a <code class="docutils literal notranslate"><span class="pre">list()</span></code> statement to generate a list from the <code class="docutils literal notranslate"><span class="pre">range()</span></code> statement.</p>
<p>Run the code cell to display the result so you can check your answer:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span># Display a list of values [1, 2, 3, 4, 5] created from a single rannge() statement

# YOUR CODE HERE
</pre></div>
</div>
</div>
<p>Now create a programme that will cause the simulated robot to count from 1 to 5 inclusive.</p>
<p>Run the cell to download the programme to the simulator, and then run it in the simulator. Does it behave as you expected?</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>%%sim_magic
# Count from 1 to 5 inclusive

# ADD YOUR CODE HERE
</pre></div>
</div>
</div>
<p>Can you modify your program so that it counts from ten to one hundred, inclusive, in tens (so, <em>ten, twenty, …, one hundred</em>)?</p>
<div class="section" id="id2">
<h4>Answer<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p><em>Click the arrow in the sidebar to reveal the answer.</em></p>
<p>We can display a range of values from <span class="math notranslate nohighlight">\(1\)</span> to <span class="math notranslate nohighlight">\(5\)</span> inclusibe by using a range command of the form <code class="docutils literal notranslate"><span class="pre">range(M,</span> <span class="pre">N)</span></code> where <code class="docutils literal notranslate"><span class="pre">M=1</span></code>, the initial value, and <span class="math notranslate nohighlight">\(N=5+1\)</span>, since the the range spans to a maximum value less than or equal to <span class="math notranslate nohighlight">\(N-1\)</span>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>list(range(1, 6))
</pre></div>
</div>
</div>
<p>We can now create a programme that counts fom one to five inclusive:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>%%sim_magic
# I can count from one to five inclusive...
import playsound

start_value = 1
# To get the desired final value, it must be within the range
# So make the range one more than the desired final value
end_value = 5 + 1

for i in range(start_value, end_value):
    playsound.say(str(i))
</pre></div>
</div>
</div>
<p>To count from ten to one hundred in tens, we need to add an additional step value as well as the range limit values:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>%%sim_magic
# I can count from ten to one hundred in tens...
import playsound

start_value = 10
end_value = 100 + 1
step_value = 10

for i in range(start_value, end_value, step_value):
    playsound.say(str(i))
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="Announcing-Bands-As-The-Robot-Encounters-Them">
<h2>Announcing Bands As The Robot Encounters Them<a class="headerlink" href="#Announcing-Bands-As-The-Robot-Encounters-Them" title="Permalink to this headline">¶</a></h2>
<p>One of the ways we can use the <code class="docutils literal notranslate"><span class="pre">playsound.say()</span></code> function is to count out the bands as we come across them. To do this, we need to identify when we cross from the white background onto a band.</p>
<p>We can detect the edge of a band by noticing when the sensor value goes from white (a reading of <span class="math notranslate nohighlight">\(100\)</span>) to a lower value. The following program will detect such a transition and say that it has crossed onto a band, also displaying a print message to announce the fact too.</p>
<p>Reset the robot location in the simulator, run the following cell to download the program to the simulator, and then run it in the simulator. Does it behave as you expected?</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>%%sim_magic_preloaded
# Onto a band...
import playsound

# Drive the robot slowly
tank_drive.on(SpeedPercent(10), SpeedPercent(10))

previous_value = colorLeft.reflected_light_intensity

while True:
    #Uncomment the following line if you want to see the trace of sensor values
    #print(&#39;Colour: &#39; + str(colorLeft.reflected_light_intensity ))
    current_value = colorLeft.reflected_light_intensity
    if previous_value==100 and current_value &lt; 100:
        print(&#39;Onto a band...&#39;)
        playsound.say(&quot;New band&quot;)

    previous_value = current_value
</pre></div>
</div>
</div>
<p>The programme starts by turning the motors on to drive the robot forward (<code class="docutils literal notranslate"><span class="pre">tank_drive.on(SpeedPercent(50),</span> <span class="pre">SpeedPercent(50))</span></code>) and then taking a sample of the light sensor reading (<code class="docutils literal notranslate"><span class="pre">previous_value</span> <span class="pre">=</span> <span class="pre">colorLeft.reflected_light_intensity</span></code>).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">True:</span></code> statement creates a loop that repeats until the programme in the simulator is manually stopped. Inside the loop, a new sample is taken of the light sensor reading (<code class="docutils literal notranslate"><span class="pre">current_value</span> <span class="pre">=</span> <span class="pre">colorLeft.reflected_light_intensity</span></code>). If the robot was on the white background on the previous iteration (<code class="docutils literal notranslate"><span class="pre">previous_value==100</span></code>) and on a band in this iteration ( and then compared to the previous value (<code class="docutils literal notranslate"><span class="pre">current_value</span> <span class="pre">&lt;</span> <span class="pre">100</span></code>) then declare that the robot has moved onto a band, via the output
display window (<code class="docutils literal notranslate"><span class="pre">print('Onto</span> <span class="pre">a</span> <span class="pre">band...')</span></code>) and audibly (<code class="docutils literal notranslate"><span class="pre">playsound.say(&quot;New</span> <span class="pre">band&quot;)</span></code>).</p>
<p>The previous value variable is then updated to the current value (<code class="docutils literal notranslate"><span class="pre">previous_value</span> <span class="pre">=</span> <span class="pre">current_value</span></code>) and the programme goes round the loop again.</p>
<p>You may notice that there is a slight delay between the robot encountering a band and saying that it has done so. This is because it takes some time to create the audio object. If we were to speed up the robot’s forward motion, it would quite possibly leave one band and encounter the next before it had finished saying it had entered the first band.</p>
<p><em>TO DO: if we queue too many audio messges, things get painful and we need to clear the speech buffer (maybe reload the page?) See</em><a class="reference external" href="https://github.com/innovationOUtside/nbev3devsim/issues/8">related issue</a><em>for how we might start to fx this.</em></p>
<div class="section" id="Activity---Announce-When-the-Robot-Has-Left-a-Band">
<h3>Activity - Announce When the Robot Has Left a Band<a class="headerlink" href="#Activity---Announce-When-the-Robot-Has-Left-a-Band" title="Permalink to this headline">¶</a></h3>
<p>In the code cell below, the previous robot control program has been modified so that the robot says “on” when it goes onto a band. Modify the programme further so that it also says, “off” when it goes from a band and back onto the white background.</p>
<p>Reset the robot location, donwload the program to the simulator and run it there. Does it behave as you expect?</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>%%sim_magic_preloaded
# On and off band...
import playsound

# Drive the robot slowly
tank_drive.on(SpeedPercent(10), SpeedPercent(10))

previous_value = colorLeft.reflected_light_intensity

while True:
    #Uncomment the following line if you want to see the trace of sensor values
    #print(&#39;Colour: &#39; + str(colorLeft.reflected_light_intensity ))
    current_value = colorLeft.reflected_light_intensity
    if previous_value==100 and current_value &lt; 100:
        print(&#39;Onto a band...&#39;)
        playsound.say(&quot;On&quot;)

    #YOUR CODE HERE


    previous_value = current_value
</pre></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>Answer<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p><em>Click the arrow in the sidebar to reveal the answer.</em></p>
<p>To detect when the robot has left a band, we can check to see if it was on a band on the previous iteration of the <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">True:</span></code> loop (<code class="docutils literal notranslate"><span class="pre">previous_value</span> <span class="pre">&lt;</span> <span class="pre">100</span></code>) and back on the white background on the current iteration (<code class="docutils literal notranslate"><span class="pre">current_value</span> <span class="pre">==</span> <span class="pre">100</span></code>).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>%%sim_magic_preloaded
# On and off band...
import playsound

# Drive the robot slowly
tank_drive.on(SpeedPercent(10), SpeedPercent(10))

previous_value = colorLeft.reflected_light_intensity

while True:
    #Uncomment the following line if you want to see the trace of sensor values
    #print(&#39;Colour: &#39; + str(colorLeft.reflected_light_intensity ))
    current_value = colorLeft.reflected_light_intensity
    if previous_value==100 and current_value &lt; 100:
        print(&#39;Onto a band...&#39;)
        playsound.say(&quot;On&quot;)

    if previous_value &lt; 100 and current_value == 100:
        print(&#39;Off a band...&#39;)
        playsound.say(&quot;Off&quot;)

    previous_value = current_value
</pre></div>
</div>
</div>
</div>
<div class="section" id="Activity---Count-the-Bands">
<h3>Activity - Count the Bands<a class="headerlink" href="#Activity---Count-the-Bands" title="Permalink to this headline">¶</a></h3>
<p>Using the previous programmes as inspiration, see if you can write a program that counts each new line as it encounters it, displaying the count to the output window and speaking the count number aloud.</p>
<p>Reset the location of the robot, download your program to the simulator and run it there. Does it work as you expected?</p>
<p><em>Hint: you may find it useful to create a counter, initially set to 0, that you increment whenever you enter a band, and then display it and speak it aloud.</em></p>
<p><em>Another hint: remember, the ``playsound()`` function must be passed a string, rather than an integer, value.</em></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>%%sim_magic_preloaded
# Count the bands aloud

# Import necessary package(s)


# Start the robot moving

# Initial count value

# Initial sensor reading

# Create a loop

    # Check current sensor reading

    # Test when the robot has entered a band

        # When on a new band:
        # - increase the count

        # - display the count in the output window

        # - say the count aloud

    # Update previous sensor reading
</pre></div>
</div>
</div>
</div>
<div class="section" id="id4">
<h3>Answer<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p><em>Click the arrow in the sidebar to reveal the answer.</em></p>
<p>Using the comment skeleton as a plan for the program, we can reuse statements from the previous programmes wwith just a few additions.</p>
<p>In the first case, we need to add a counter (<code class="docutils literal notranslate"><span class="pre">count</span> <span class="pre">=</span> <span class="pre">0</span></code>). Inside the loop, when we detect we are on a new band, increase the counter (<code class="docutils literal notranslate"><span class="pre">count</span> <span class="pre">=</span> <span class="pre">count</span> <span class="pre">+</span> <span class="pre">1</span></code>), display it (<code class="docutils literal notranslate"><span class="pre">print(count)</span></code>) and after casting the count to string value, speak it aloud (<code class="docutils literal notranslate"><span class="pre">playsound.say(str(count))</span></code>).</p>
<p>Note that we could make out output display message a little bit more elaborate by constructing an output message string, such as <code class="docutils literal notranslate"><span class="pre">print(&quot;Band</span> <span class="pre">count</span> <span class="pre">is&quot;</span> <span class="pre">+</span> <span class="pre">str(count))</span></code>. <em>(Unfortunately, the simulator does not support the rather more elaborate Python “f-string” formatting method.)</em></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>%%sim_magic_preloaded
# Count the bands aloud

# Import necessary package(s)
import playsound

# Start the robot moving
tank_drive.on(SpeedPercent(10), SpeedPercent(10))

# Initial count value
count = 0

# Initial sensor reading
previous_value = colorLeft.reflected_light_intensity

# Create a loop
while True:

    # Check current sensor reading
    current_value = colorLeft.reflected_light_intensity

    # Test when the robot has entered a band
    if previous_value==100 and current_value &lt; 100:
        # When on a new band:
        # - increase the count
        count = count + 1
        # - display the count in the output window
        print(count)
        # - say the count aloud
        playsound.say(str(count))

    # Update previous sensor reading
    previous_value = current_value
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Summary">
<h2>Summary<a class="headerlink" href="#Summary" title="Permalink to this headline">¶</a></h2>
<p>In this notebook, you have seen how we can use the simulator to load in a particular background and log and chart sensor values captured as the robot moves over the simulator background both within the simulator and in the notebook environment itself.</p>
<p>You have also seen how we can get the robot to count as we iterate through a range of values.</p>
<p>By keeping track of previous and current sensor values, you have seen how the robot can identify when it encounters a new feature in the simulated world, such as entering or leaving a coloured band. Using the speak functionality, the robot can also alert us to when it encounters a new object.</p>
</div>
</div>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="Section_00_02_ev3devsim_simulator_overview.html" title="Previous document">The <code class="docutils literal notranslate"><span class="pre">ev3devsim</span></code> Simulator</a>
        </li>
        <li>
          <a href="Section_00_04_LEGACY_UNUSED_IGNORE.html" title="Next document">4.1 Activity: Remote control</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">TM129 Robotics Practical Activities</a></h1>



<p class="blurb">Documentation...</p>






<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../00_NOTES_FOR_TUTORS/GETTING_STARTED.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../00_READ_ME_FIRST/Section.html">Developer Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../00_READ_ME_FIRST/Section_00_01_Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../00_READ_ME_FIRST/Section_00_02_Workload.html">1.2 Workload</a></li>
<li class="toctree-l1"><a class="reference internal" href="../00_READ_ME_FIRST/Section_00_03_Accessibility.html">1.3 Accessibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../00_READ_ME_FIRST/Section_00_04_Writing_Code.html">1.4 Writing Style Compliant Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../00_READ_ME_FIRST/Section_00_05_Accessing_RoboLab.html">1.5 Gaining Access to the RoboLab Environment</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Section_00_01_Jupyter_environment.html">1 Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_00_02-nb3devsim.html">2 The RoboLab simulated on-screen robot (<code class="docutils literal notranslate"><span class="pre">nbev3devsim</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_00_02-nb3devsim.html#Move-robot-forward">Move robot forward</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_00_02-nb3devsim.html#Move-robot-forward-for-3-seconds">Move robot forward for 3 seconds</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_00_02_ev3devsim_simulator_overview.html">The <code class="docutils literal notranslate"><span class="pre">ev3devsim</span></code> Simulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_00_02_ev3devsim_simulator_overview.html#The-EV3-“Brick”">The EV3 “Brick”</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_00_02_ev3devsim_simulator_overview.html#Simulator-Overview">Simulator Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_00_02_ev3devsim_simulator_overview.html#Robot-Configuration">Robot Configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3 Some features of RoboLab</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#3.1-Activity:-Keeping-a-robot-in-an-area">3.1 Activity: Keeping a robot in an area</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Using-Less-Magic…">Using Less Magic…</a></li>
<li class="toctree-l2"><a class="reference internal" href="#A-Complete-Python-Programme">A Complete Python Programme</a></li>
<li class="toctree-l2"><a class="reference internal" href="#3.2-Activity:-Investigating-sensors">3.2 Activity: Investigating sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Activity---Viewing-the-Logged-Data---The-Simulator-Datalog-Chart-Display">Activity - Viewing the Logged Data - The Simulator Datalog Chart Display</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Viewing-the-Logged-Data---Uploading-the-Logged-Data-to-the-Notebook">Viewing the Logged Data - Uploading the Logged Data to the Notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Robots-that-speak">Robots that speak</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Robots-That-Count">Robots That Count</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Announcing-Bands-As-The-Robot-Encounters-Them">Announcing Bands As The Robot Encounters Them</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Section_00_04_LEGACY_UNUSED_IGNORE.html">4.1 Activity: Remote control</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_00_04_LEGACY_UNUSED_IGNORE.html#4.2-Activity:-More-remote-control">4.2 Activity: More remote control</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../01_Robot_Lab/Section_00_02.html">2 Constants and variables in programs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02_Robot_Lab/Section_00_01.html">1 Introduction to loops and branches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_Robot_Lab/Section_00_01.html#2-Loops">2 Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_Robot_Lab/Section_00_02.html">3 Branches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_Robot_Lab/Section_00_03.html">Challenge: Making a countdown program</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_Robot_Lab/Section_00_03.html#Challenge:-Traversing-a-hook">Challenge: Traversing a hook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_Robot_Lab/Section_00_04.html">4 Optional challenges</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../03_Robot_Lab/Section_00_01.html">1 Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_Robot_Lab/Section_00_02.html">2 Dead reckoning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_Robot_Lab/Section_00_03.html">4 Emergent behaviour: Braitenberg’s vehicles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_Robot_Lab/Section_00_03.html#Using-Ultrasound">Using Ultrasound</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_Robot_Lab/Section_00_04.html">4 Reasoning and the sense–think–act model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_Robot_Lab/Section_00_05.html">5 Functions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../04_Robot_Lab/Section_00_01.html">1 Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_Robot_Lab/Section_00_02.html">2 Line followers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_Robot_Lab/Section_00_04.html">4 The design engineer as detective</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="Section_00_02_ev3devsim_simulator_overview.html" title="previous chapter">The <code class="docutils literal notranslate"><span class="pre">ev3devsim</span></code> Simulator</a></li>
      <li>Next: <a href="Section_00_04_LEGACY_UNUSED_IGNORE.html" title="next chapter">4.1 Activity: Remote control</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The Open University, 2020.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/content/00_SOFTWARE_GUIDE/Section_00_03_quick_practical_tour.md"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>