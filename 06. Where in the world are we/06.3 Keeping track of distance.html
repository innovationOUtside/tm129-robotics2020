
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3 Keeping track of distance – how far have we come? &#8212; TM129 Robotics Practical Activities</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4 Keeping track of direction – which way are we heading?" href="06.4%20Keeping%20track%20of%20direction.html" />
    <link rel="prev" title="2 Runaround" href="06.2%20Runaround.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      <h1 class="site-logo" id="site-title">TM129 Robotics Practical Activities</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../README_FIRST.html">
   Welcome to the TM129 Robotics block
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../00_FOR_VLE/Section_00_01_Introduction.html">
   1 Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../00_NOTES_FOR_TUTORS/GETTING_STARTED.html">
   Getting started
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01.%20Introducing%20notebooks%20and%20the%20RoboLab%20environment/01.1%20Jupyter%20environment.html">
   1 Introduction to the TM129 Jupyter notebook environment
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01.%20Introducing%20notebooks%20and%20the%20RoboLab%20environment/01.2%20Exploring%20the%20notebook%20environment.html">
     2 The interactive read-writable notebook environment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01.%20Introducing%20notebooks%20and%20the%20RoboLab%20environment/01.3%20Introducing%20nbev3devsim.html">
     3 The RoboLab simulated on-screen robot (
     <code class="docutils literal notranslate">
      <span class="pre">
       nbev3devsim
      </span>
     </code>
     )
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01.%20Introducing%20notebooks%20and%20the%20RoboLab%20environment/01.4%20Exploring%20nbev3devsim.html">
     4 Exploring the
     <code class="docutils literal notranslate">
      <span class="pre">
       nbev3devsim
      </span>
     </code>
     simulator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01.%20Introducing%20notebooks%20and%20the%20RoboLab%20environment/01.5%20Example%20robot%20program.html">
     5 An example robot program
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01.%20Introducing%20notebooks%20and%20the%20RoboLab%20environment/01.6%20Working%20With%20Simulators.html">
     6 Working with simulators
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02.%20Getting%20started%20with%20robot%20and%20Python%20programming/02.1%20Robot%20programming%20constructs.html">
   1 An introduction to programming robots
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02.%20Getting%20started%20with%20robot%20and%20Python%20programming/02.2%20Creating%20your%20own%20robot%20programs.html">
     2 Creating your own robot programs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02.%20Getting%20started%20with%20robot%20and%20Python%20programming/02.3%20General%20programming%20concepts.html">
     3.1 Constants and variables in programs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02.%20Getting%20started%20with%20robot%20and%20Python%20programming/02.4%20Getting%20started%20with%20sensors.html">
     4 Robot sensors and data logging
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.1%20Program%20control%20using%20for%20loops.html">
   1 Introduction to program control flow
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.2%20Program%20control%20using%20while%20loops%20and%20blocking.html">
     2 Program control flow using a
     <code class="docutils literal notranslate">
      <span class="pre">
       while...
      </span>
     </code>
     loop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.3%20Program%20control%20flow%20using%20branches.html">
     3 Branches
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.4%20Example%20robot%20control%20programs.html">
     4 Example robot control programs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.5%20Some%20RoboLab%20challenges.html">
     5 RoboLab challenges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.6%20Optional%20RoboLab%20challenges.html">
     6 Optional challenges
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04.%20Not%20quite%20intelligent%20robots/04.1%20Introducing%20program%20functions.html">
   1 Introduction to functions and robot control strategies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04.%20Not%20quite%20intelligent%20robots/04.2%20Robot%20navigation%20using%20dead%20reckoning.html">
     2 Dead reckoning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04.%20Not%20quite%20intelligent%20robots/04.3%20Emergent%20robot%20behaviour%20and%20simple%20data%20charts.html">
     3 Emergent robot behaviour and simple data charts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04.%20Not%20quite%20intelligent%20robots/04.4%20Reasoning%20with%20Eliza.html">
     4 Reasoning with Eliza
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04.%20Not%20quite%20intelligent%20robots/04.5%20Reasoning%20with%20rule%20based%20systems.html">
     5 Reasoning with rule-based systems – Durable Rules Engine
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05.%20Experimenting%20with%20sensors/05.1%20Introducing%20sensor%20based%20control.html">
   Introduction to sensor-based control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06.1%20Introducing%20sensor%20based%20navigation.html">
   Introducing sensor-based navigation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07.%20Neural%20networks/07.1%20Introducing%20neural%20networks.html">
   1 Introducing neural networks
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.1%20Introducing%20remote%20services%20and%20multi-agent%20systems.html">
   1 An introduction to remote services and multi-agent systems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.2%20Collecting%20digit%20image%20and%20class%20data%20from%20the%20simulator.html">
     2 Collecting digit image and class data from the simulator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.3%20Recognising%20digits%20using%20a%20convolutional%20neural%20network%20%28optional%29.html">
     3 Recognising digits using a convolutional neural network (optional)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.4%20Recognising%20patterns%20on%20the%20move.html">
     4 Recognising patterns on the move
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.5%20Messaging%20in%20multi-agent%20systems.html">
     5 Messaging in multi-agent systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.6%20Conclusion.html">
     6 Conclusion
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/06. Where in the world are we/06.3 Keeping track of distance.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/06. Where in the world are we/06.3 Keeping track of distance.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#motor-tachometer-or-rotation-sensor-data">
   3.1 Motor tachometer or ‘rotation sensor’ data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#activity-keeping-track-of-motor-position-data">
     3.1.1 Activity – Keeping track of motor position data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#viewing-the-data-in-a-notebook-chart">
     3.1.2 Viewing the data in a notebook chart
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-your-own-annotated-chart-optional">
     3.1.3 Create your own annotated chart (optional)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#activity-observing-motor-position-counts-for-different-motor-actions-optional">
     3.1.4 Activity – Observing motor position counts for different motor actions (optional)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#measuring-how-far-the-robot-has-travelled">
   3.2 Measuring how far the robot has travelled
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#activity-driving-the-robot-for-a-fixed-number-of-wheel-rotations">
     3.2.1 Activity – Driving the robot for a fixed number of wheel rotations
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#example-observations">
       Example observations
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#controlling-the-distance-travelled">
   3.3 Controlling the distance travelled
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#activity-are-we-there-yet">
     3.3.1 Activity – Are we there yet?
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Example observations
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#measuring-the-width-of-a-coloured-track">
   3.4 Measuring the width of a coloured track
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-logged-data-to-take-measurements-from-the-simulated-world-optional">
     3.4.1 Using logged data to take measurements from the simulated world (optional)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Example observations
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   3.5 Summary
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="keeping-track-of-distance-how-far-have-we-come">
<h1>3 Keeping track of distance – how far have we come?<a class="headerlink" href="#keeping-track-of-distance-how-far-have-we-come" title="Permalink to this headline">¶</a></h1>
<p>One of the main problems a robot has is locating itself in its environment: the simulated robot doesn’t know where it is in the simulated world. Within the simulator, some <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> coordinate values are used by the simulator to keep track of the simulated robot’s location, and an angle parameter records its orientation. This information is then used to draw the robot on the background canvas.</p>
<p>Typically when using a simulator, we try not to cheat by providing the robot direct access to simulator state information. That would be rather like you going outside, raising your arms to the sky, shouting ‘<em>Where am I?</em>’ and the universe responding with your current location.</p>
<p>Instead, we try to ensure that the information on which the robot makes its decisions comes from its own internal reasoning and any sensor values it has access to.</p>
<p>At this point, we could create a magical ‘simulated-GPS’ sensor that allows the robot to identify its location from the simulator’s point of view; but in the real world we can’t always guarantee that external location services are available. For example, GPS doesn’t work indoors or underground, or even in many cities where line-of-sight access to four or more GPS satellites is not available.</p>
<p>Instead, we often have to rely on other sensors to help us identify our robot’s location, at least in a relative sense to where it has been previously. So that’s what we’ll be exploring in this notebook.</p>
<p>Load in the simulator in the normal way, and then we’ll begin.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nbev3devsim.load_nbev3devwidget</span> <span class="kn">import</span> <span class="n">roboSim</span><span class="p">,</span> <span class="n">eds</span>

<span class="o">%</span><span class="n">load_ext</span> <span class="n">nbev3devsim</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="motor-tachometer-or-rotation-sensor-data">
<h2>3.1 Motor tachometer or ‘rotation sensor’ data<a class="headerlink" href="#motor-tachometer-or-rotation-sensor-data" title="Permalink to this headline">¶</a></h2>
<p>We can get a sense of how far the robot has travelled by logging the <code class="docutils literal notranslate"><span class="pre">.position</span></code> of each motor as recorded by its internal tachometer. Inside a real motor, a rotary encoder can be used to detect rotation of the motor. When the motor turns in one direction, the count goes up; when it turns in the other direction, it goes down.</p>
<p>We’ll be looking at the logged data using notebook tools, so let’s take the precaution of clearing the datalog and also setting up a default chart object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">sim_data</span> <span class="o">--</span><span class="n">clear</span>
<span class="o">%</span><span class="n">sim_magic</span> <span class="o">--</span><span class="n">chart</span>
</pre></div>
</div>
</div>
</div>
<p>In the chart, make sure the <em>Wheel left</em> and <em>Wheel right</em> traces are selected.</p>
<p>As well as each sensor value, we will also capture the simulator ‘clock time’.</p>
<p>When running the simulator, you may have noticed that the simulator sometimes seems to slow down, perhaps because your computer processor is interrupted by having to commit resource to some other task. Inside the simulator, however, is an internal clock that counts simulator steps. Depending on how much work the simulator has to do to calculate updates in each step of the simulator run, this may take more or less ‘real time’ as measured by a clock on your wall (or, more likely, the clock on your mobile phone!).</p>
<p>By logging the simulator step time using the preloaded <code class="docutils literal notranslate"><span class="pre">get_clock()</span></code> function, we can create a more accurate plot of the sensor values at each step of simulator time, irrespective of how long that step took to calculate in the real world.</p>
<p>In his book <em>New Dark Age</em>, artist James Bridle describes the evolution of weather forecasting based on mathematical models:</p>
<blockquote>
<div><p>In 1950, a team of meteorologists assembled at Aberdeen in order to perform the first automated twenty-four-hour weather forecast…. For this project, the boundaries of the world were the edges of the continental United States; a grid separated it into fifteen rows and eighteen columns. The calculation programmed into the machine consisted of sixteen successive operations, each of which had to be carefully planned and punched into cards, and which in turn output a new deck of cards that had to be reproduced, collated, and sorted. The meteorologists worked in eight-hour shifts, supported by programmers, and the entire run absorbed almost five weeks, 100,000 IBM punch cards, and a million mathematical operations. But when the experimental logs were examined, von Neumann, the director of the experiment, discovered that the actual computational time was almost exactly twenty-four hours. ‘One has reason to hope’, he wrote, that ‘Richardson’s dream of advancing computation faster than the weather may soon be realised’.</p>
</div></blockquote>
<p><em>Historical note: Lewis Fry Richardson was an early pioneer of weather forecasting, whose story is also summarised by Bridle.</em></p>
<p>As Bridle observes, the number crunching required to perform a weather forecast requires the solution of lots of complex mathematical equations, so much so that the earliest computers might take days to make a 24-hour weather forecast. If you’re in the habit of checking online weather reports just before you set out for the day, they wouldn’t be much use if they took the next three days to compute. Although our simulator is a simple one, at times it may still take more computational resource than is available to the program for it to compute a single second of time in the simulated world in less than a second of real-world time.</p>
<p>Reference: Bridle, J. (2018) <em>New Dark Age: Technology and the End of the Future</em>, London: Verso Books.</p>
<div class="section" id="activity-keeping-track-of-motor-position-data">
<h3>3.1.1 Activity – Keeping track of motor position data<a class="headerlink" href="#activity-keeping-track-of-motor-position-data" title="Permalink to this headline">¶</a></h3>
<p>The following program logs the position count as we drive the robot forwards, backwards, wait a while, then turn on the spot slowly one way, then quickly the other. I have also instrumented it so that the simulated robot says aloud what it is about to do next as the program progresses.</p>
<p>For convenience, let’s clear the datalog again just here:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">sim_data</span> <span class="o">--</span><span class="n">clear</span>
</pre></div>
</div>
</div>
</div>
<p>Download the program, and then enable the <em>Chart display</em> from the simulator toggle display buttons.</p>
<p>Ensure the <em>Left wheel</em> and <em>Right wheel</em> traces are selected, then run the program from the <em>Simulator controls</em> or keyboard shortcut (<code class="docutils literal notranslate"><span class="pre">R</span></code>).</p>
<p>Observe what happens to the wheel position counts as the robot progresses.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sim_magic_preloaded</span> <span class="o">-</span><span class="n">pC</span> <span class="o">-</span><span class="n">b</span> <span class="n">Empty_Map</span> <span class="o">-</span><span class="n">x</span> <span class="mi">250</span> <span class="o">-</span><span class="n">y</span> <span class="mi">550</span>

<span class="n">tank_steering</span> <span class="o">=</span> <span class="n">MoveSteering</span><span class="p">(</span><span class="n">OUTPUT_B</span><span class="p">,</span> <span class="n">OUTPUT_C</span><span class="p">)</span>

<span class="n">tank_steering</span><span class="o">.</span><span class="n">left_motor</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">tank_steering</span><span class="o">.</span><span class="n">right_motor</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1">#tank_steering.on(DIRECTION, SPEED)</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="n">SAMPLE_TIME</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="k">def</span> <span class="nf">datalogger</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Simple datalogging function.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wheel_left: </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tank_steering</span><span class="o">.</span><span class="n">left_motor</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">get_clock</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wheel_right: </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tank_steering</span><span class="o">.</span><span class="n">right_motor</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">get_clock</span><span class="p">()))</span>
    <span class="n">sleep</span><span class="p">(</span><span class="n">SAMPLE_TIME</span><span class="p">)</span>

<span class="c1"># Move forwards quickly</span>
<span class="n">say</span><span class="p">(</span><span class="s2">&quot;Forwards quickly&quot;</span><span class="p">)</span>
<span class="n">tank_steering</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">datalogger</span><span class="p">()</span>

<span class="c1"># Move forwards slowly</span>
<span class="n">say</span><span class="p">(</span><span class="s2">&quot;Forwards slowly&quot;</span><span class="p">)</span>
<span class="n">tank_steering</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">40</span><span class="p">):</span>
    <span class="n">datalogger</span><span class="p">()</span>

<span class="c1"># Move backwards at intermediate speed</span>
<span class="n">say</span><span class="p">(</span><span class="s2">&quot;Backwards medium&quot;</span><span class="p">)</span>
<span class="n">tank_steering</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">datalogger</span><span class="p">()</span>

<span class="c1"># Stop awhile</span>
<span class="n">say</span><span class="p">(</span><span class="s2">&quot;Stop awhile&quot;</span><span class="p">)</span>
<span class="n">tank_steering</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">datalogger</span><span class="p">()</span>

    
<span class="c1"># Turn slowly on the spot</span>
<span class="n">say</span><span class="p">(</span><span class="s2">&quot;On the spot&quot;</span><span class="p">)</span>
<span class="n">tank_steering</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">datalogger</span><span class="p">()</span>
    
<span class="c1"># Turn more quickly on the spot the other way</span>
<span class="n">say</span><span class="p">(</span><span class="s2">&quot;And back&quot;</span><span class="p">)</span>
<span class="n">tank_steering</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">datalogger</span><span class="p">()</span>

<span class="n">say</span><span class="p">(</span><span class="s2">&quot;All done&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em>Record your observations about the chart data trace here. Make your own notes to describe how the behaviour of the different motor position chart traces explains the observed behaviour of the robot.</em></p>
</div>
<div class="section" id="viewing-the-data-in-a-notebook-chart">
<h3>3.1.2 Viewing the data in a notebook chart<a class="headerlink" href="#viewing-the-data-in-a-notebook-chart" title="Permalink to this headline">¶</a></h3>
<p>The chart display in the simulator uses ‘sample number’ along the horizontal <em>x</em>-axis to log the data. This can result in some misleading traces as we can currently only add one sensor value to each sample.</p>
<p>To plot the data more accurately, we need to plot the samples as a proper time series, with the sample timestamp as the <em>x</em>-coordinate.</p>
<p>We can do that by charting the data from the datalog directly in the notebook.</p>
<p>Retrieve the data from the datalog, and preview it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Grab the logged data into a pandas dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="o">%</span><span class="n">sim_data</span>

<span class="c1">#Preview the first few rows of the dataset</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can chart the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load in the seaborn charting package</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># Generate a line chart from the datalog dataframe</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span>
                  <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
                  <span class="c1"># The hue category defines line color</span>
                  <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span>
                  <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s a stylised impression of what my chart looked like:</p>
<p><img alt="" src="../_images/position_time.png" /></p>
<p>You’ll notice that I have added some vertical grey lines to my chart to indicate different areas of the chart, as well as some simple labels identifying each area.</p>
<p>Annotating charts can often help us make more sense of them when we try to read them. In creating such charts there is often a balance between making a ‘production quality’ chart that you could share with other people as part of a formal report (or formal teaching materials!) and a ‘good enough for personal use’ feel for your own reference.</p>
<p>In this regard, you may also notice that the chart shown above has an informal, stylised feel to it. The chart really was created from the data I collected, but I then styled it using an XKCD chart theme to differentiate it from the charts generated within the notebook.</p>
</div>
<div class="section" id="create-your-own-annotated-chart-optional">
<h3>3.1.3 Create your own annotated chart (optional)<a class="headerlink" href="#create-your-own-annotated-chart-optional" title="Permalink to this headline">¶</a></h3>
<p><em>Click on the arrow in the sidebar or run this cell to reveal how to create the annotated chart.</em></p>
<p>I used the following code to create the annotated chart. I manually set the horizontal <em>x</em>-axis values where I wanted the vertical lines to appear.</p>
<div class="cell tag_optional-extra docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Manually set x-axis coordinates for vertical lines</span>
<span class="n">forward_fast</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">forward_slow</span> <span class="o">=</span> <span class="mf">1.6</span>
<span class="n">backwards_medium</span> <span class="o">=</span> <span class="mf">4.1</span>
<span class="n">stop_awhile</span> <span class="o">=</span> <span class="mf">5.5</span>
<span class="n">on_the_spot</span> <span class="o">=</span> <span class="mf">6.7</span>
<span class="n">and_back</span> <span class="o">=</span> <span class="mf">8.0</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="s1">&#39;.*missing from current font.*&#39;</span><span class="p">,)</span>

<span class="c1"># We need some additional tools from matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># I am using the xkcd theme.</span>
<span class="c1"># This gives the chart an informal</span>
<span class="c1"># or &#39;indicative example&#39; feel</span>
<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">xkcd</span><span class="p">():</span>
    <span class="c1"># Generate a line chart from the datalog dataframe</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span>
                      <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
                      <span class="c1"># The hue category defines line color</span>
                      <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span>
                      <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>

    <span class="c1"># Move the legend outside the plotting area.</span>
    <span class="c1"># The prevents it from overlapping areas of the plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

    <span class="n">o</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1">#offset text from line</span>
    <span class="n">line_colour</span> <span class="o">=</span> <span class="s1">&#39;lightgrey&#39;</span>

    <span class="k">def</span> <span class="nf">plot_line_label</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Annotate boundaried areas.&quot;&quot;&quot;</span>
        <span class="c1"># Create a vertical line</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">line_colour</span><span class="p">)</span>
        <span class="c1"># Create a text label</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">o</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>

    <span class="c1"># Add lines and labels to the chart</span>
    <span class="n">plot_line_label</span><span class="p">(</span><span class="n">forward_fast</span><span class="p">,</span> <span class="s1">&#39;Fwd</span><span class="se">\n</span><span class="s1">fast&#39;</span><span class="p">)</span>
    <span class="n">plot_line_label</span><span class="p">(</span><span class="n">forward_slow</span><span class="p">,</span> <span class="s1">&#39;Fwd</span><span class="se">\n</span><span class="s1">slow&#39;</span><span class="p">)</span>
    <span class="n">plot_line_label</span><span class="p">(</span><span class="n">backwards_medium</span><span class="p">,</span> <span class="s1">&#39;Back</span><span class="se">\n</span><span class="s1">med&#39;</span><span class="p">)</span>
    <span class="n">plot_line_label</span><span class="p">(</span><span class="n">stop_awhile</span><span class="p">,</span> <span class="s1">&#39;Stop</span><span class="se">\n</span><span class="s1">awhile&#39;</span><span class="p">)</span>
    <span class="n">plot_line_label</span><span class="p">(</span><span class="n">on_the_spot</span><span class="p">,</span> <span class="s1">&#39;On the</span><span class="se">\n</span><span class="s1">spot&#39;</span><span class="p">)</span>
    <span class="n">plot_line_label</span><span class="p">(</span><span class="n">and_back</span><span class="p">,</span> <span class="s1">&#39;And</span><span class="se">\n</span><span class="s1">back&#39;</span><span class="p">);</span>

    <span class="c1"># We can save the image as a file if required.</span>
    <span class="c1"># Increase the figure size</span>
    <span class="c1">#plt.figure(figsize=(12,8))</span>
    <span class="c1"># Nudge the margins so we don&#39;t cut off labels</span>
    <span class="c1">#plt.subplots_adjust(left=0.1, bottom=0.1,</span>
    <span class="c1">#                    right=0.7, top=0.8)</span>
    <span class="c1"># Save the image file</span>
    <span class="c1">#plt.savefig(&#39;position_time.png&#39;)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="activity-observing-motor-position-counts-for-different-motor-actions-optional">
<h3>3.1.4 Activity – Observing motor position counts for different motor actions (optional)<a class="headerlink" href="#activity-observing-motor-position-counts-for-different-motor-actions-optional" title="Permalink to this headline">¶</a></h3>
<p>How do the position counts vary for each wheel if the robot is driving forwards in a gentle curve, or a tight turn?</p>
<p>For example, we might create such turns using the following steering commands:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Graceful forwards left</span>
<span class="n">tank_steering</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="c1"># Tighter turn forwards and to the right &lt;!-- JD: but this is the same as the code above for a &#39;graceful left turn&#39;. Needs to be something like 40, 100 --&gt;</span>
<span class="n">tank_steering</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<p>Feel free to make your own predictions, or run a program, grab the data and analyse it yourself. If you do run your own experiment(s), then remember to clear the datalog before running your data-collecting code in the simulator.</p>
</div>
</div>
<div class="section" id="measuring-how-far-the-robot-has-travelled">
<h2>3.2 Measuring how far the robot has travelled<a class="headerlink" href="#measuring-how-far-the-robot-has-travelled" title="Permalink to this headline">¶</a></h2>
<p>The wheel <code class="docutils literal notranslate"><span class="pre">position</span></code> data corresponds to an angular measure, that is, how far the wheel has turned.</p>
<div class="section" id="activity-driving-the-robot-for-a-fixed-number-of-wheel-rotations">
<h3>3.2.1 Activity – Driving the robot for a fixed number of wheel rotations<a class="headerlink" href="#activity-driving-the-robot-for-a-fixed-number-of-wheel-rotations" title="Permalink to this headline">¶</a></h3>
<p>Use the following program to drive the robot for a fixed number of rotations and observe how the position count increases. Based on your observations, make a note of what you think the position count actually measures.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sim_magic_preloaded</span>

<span class="n">tank_steering</span><span class="o">=</span> <span class="n">MoveSteering</span><span class="p">(</span><span class="n">OUTPUT_B</span><span class="p">,</span> <span class="n">OUTPUT_C</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">reporter</span><span class="p">(</span><span class="n">last_position</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">position</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tank_steering</span><span class="o">.</span><span class="n">left_motor</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">position</span> <span class="o">-</span> <span class="n">last_position</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current </span><span class="si">{}</span><span class="s1">, diff </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">diff</span><span class="p">))</span>
    <span class="n">say</span><span class="p">(</span><span class="s1">&#39;Diff </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">position</span>

<span class="n">tank_steering</span><span class="o">.</span><span class="n">on_for_rotations</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">last_position</span> <span class="o">=</span> <span class="n">reporter</span><span class="p">()</span>

<span class="n">tank_steering</span><span class="o">.</span><span class="n">on_for_rotations</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">last_position</span> <span class="o">=</span> <span class="n">reporter</span><span class="p">(</span><span class="n">last_position</span><span class="p">)</span>

<span class="n">tank_steering</span><span class="o">.</span><span class="n">on_for_rotations</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">reporter</span><span class="p">(</span><span class="n">last_position</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em>Based on your observations of position counts for the number of wheel rotations travelled, what do you think the position value measures? Bear in mind that the simulation, like the real world, may have sources of noise that affect the actual values recorded, rather than ‘ideal’ ones.</em></p>
<p><em>Record your impressions here.</em></p>
<div class="section" id="example-observations">
<h4>Example observations<a class="headerlink" href="#example-observations" title="Permalink to this headline">¶</a></h4>
<p><em>Click the arrow in the sidebar or run this cell to reveal my observations.</em></p>
<p>When I ran the program, I got counts between 365 and 380 for each rotation, depending in part on the speed I set the wheels to run at.</p>
<p>The simulator actually runs in steps, with 30 steps per simulated second. This means that at 20% speed, the wheel will turn approximately 6 to 7 degrees each step. By the time the simulator detects that the wheel has reached <em>at least</em> 360 degrees (i.e. completed one rotation), it may already have exceeded that amount of turn; so the stopping condition for the <code class="docutils literal notranslate"><span class="pre">.on_for_rotations</span></code> function, which is based on observing the turned angle, may actually stop the motors after more than one rotation.</p>
<p>So notwithstanding the values we get for the position count after a single rotation, the position is actually measured in degrees.</p>
</div>
</div>
</div>
<div class="section" id="controlling-the-distance-travelled">
<h2>3.3 Controlling the distance travelled<a class="headerlink" href="#controlling-the-distance-travelled" title="Permalink to this headline">¶</a></h2>
<p>If we can continuously monitor the distance we have travelled, then we can use that as part of a control strategy in a non-blocking way: rather than tell the motors to turn on for N rotations, we can just turn them on, and then take a particular action when they have turned far enough <em>as we have measured them</em>.</p>
<div class="section" id="activity-are-we-there-yet">
<h3>3.3.1 Activity – Are we there yet?<a class="headerlink" href="#activity-are-we-there-yet" title="Permalink to this headline">¶</a></h3>
<p>In this activity, you will experiment with driving the robot over a fixed distance.</p>
<p>Nominally, the wheel diameter is set in the robot configuration file to <code class="docutils literal notranslate"><span class="pre">56</span></code>, that is, 56 mm, so just under six centimetres.</p>
<p>What this means is that we can drive the robot forward a specified distance.</p>
<p>The bands shown on the <em>Coloured_bands</em> background are 60 cm high.</p>
<p>See if you can write a program that drives the robot exactly the length of one of the bands by monitoring the <code class="docutils literal notranslate"><span class="pre">position</span></code> value of one of the motors as the robot drives in a straight line.</p>
<p>How accurately can you cover the distance? (Don’t panic, or waste too much time, if you can’t…). Comment on your results.</p>
<p><strong>Hint: how many degrees will the wheel need to turn for the wheel to turn 60 cm?</strong></p>
<p><strong>Warning: if you use a loop then put something in it that uses up simulator time and progresses the clock, such as a short <code class="docutils literal notranslate"><span class="pre">sleep(0.1)</span></code> command, otherwise you may find that your simulator Python program gets stuck and hangs the browser.</strong></p>
<p><em>If that happens try to reload the notebook in the browser.</em></p>
<p><em>If that doesn’t work, from the notebook home page, try to shutdown the notebook.</em></p>
<p><em>If that is also stuck, restart your browser.</em></p>
<p><em>If things are still not working properly, you will need to restart the container from Docker dashboard or the command line: <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">restart</span> <span class="pre">tm129vce</span></code>.</em></p>
<p><em>Note: the <code class="docutils literal notranslate"><span class="pre">.position</span></code> value is returned as a string and should be converted to an integer (<code class="docutils literal notranslate"><span class="pre">int</span></code>) if you want to use it numerically.</em></p>
<p><em>How many degrees does the wheel need to turn? Record your calculation and result here.</em></p>
<p><em>Remember that you can use a code cell as a interactive calculator. You can access pi as a number by importing <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">math</span> <span class="pre">import</span> <span class="pre">pi</span></code>.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sim_magic_preloaded</span> <span class="o">-</span><span class="n">b</span> <span class="n">Coloured_bands</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">x</span> <span class="mi">1100</span> <span class="o">-</span><span class="n">y</span> <span class="mi">200</span> <span class="o">-</span><span class="n">a</span> <span class="mi">90</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
    
<span class="c1"># Your code here</span>
</pre></div>
</div>
</div>
</div>
<p><em>Record your notes and observations here about how effectively the robot performed the desired task.</em></p>
<div class="section" id="id1">
<h4>Example observations<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p><em>Click on the arrow in the sidebar or run this cell to reveal some example observations.</em></p>
<p>The <code class="docutils literal notranslate"><span class="pre">position</span></code> counter reports the number of degrees turned by the wheel, so let’s start by finding out how many degrees we need to turn the wheel to travel 60 cm.</p>
<p>Recall that the wheel diameter is 56 mm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span>

<span class="n">distance</span> <span class="o">=</span> <span class="mi">60</span> <span class="c1">#cm</span>

<span class="c1"># 56mm is 5.6cm</span>
<span class="n">circumference</span> <span class="o">=</span> <span class="mf">5.6</span> <span class="o">*</span> <span class="n">pi</span>

<span class="n">no_of_turns</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">/</span> <span class="n">circumference</span>
<span class="n">no_of_degrees</span> <span class="o">=</span> <span class="n">no_of_turns</span> <span class="o">*</span> <span class="mi">360</span>

<span class="nb">int</span><span class="p">(</span><span class="n">no_of_degrees</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can use this calculation in a program that drives the robot forward until the wheels have turned by the desired amount, and then stops.</p>
<p>Note that the speed of the robot may affect how accurately the robot can perform the task, bearing in mind the comment earlier about how the simulator uses quite crude discrete time steps to animate the world.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sim_magic_preloaded</span> <span class="o">-</span><span class="n">b</span> <span class="n">Coloured_bands</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">x</span> <span class="mi">1100</span> <span class="o">-</span><span class="n">y</span> <span class="mi">200</span> <span class="o">-</span><span class="n">a</span> <span class="mi">90</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="n">tank_steering</span><span class="o">=</span> <span class="n">MoveSteering</span><span class="p">(</span><span class="n">OUTPUT_B</span><span class="p">,</span> <span class="n">OUTPUT_C</span><span class="p">)</span>

<span class="c1"># Go Forwards</span>
<span class="n">DIRECTION</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">SPEED</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">tank_steering</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">DIRECTION</span><span class="p">,</span> <span class="n">SPEED</span><span class="p">)</span>


<span class="c1"># Do the math...</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span>

<span class="n">distance</span> <span class="o">=</span> <span class="mi">60</span> <span class="c1">#cm</span>

<span class="c1"># 56mm is 5.6cm</span>
<span class="n">circumference</span> <span class="o">=</span> <span class="mf">5.6</span> <span class="o">*</span> <span class="n">pi</span>

<span class="n">no_of_turns</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">/</span> <span class="n">circumference</span>
<span class="n">no_of_degrees</span> <span class="o">=</span> <span class="n">no_of_turns</span> <span class="o">*</span> <span class="mi">360</span>


<span class="k">while</span> <span class="nb">int</span><span class="p">(</span><span class="n">tank_steering</span><span class="o">.</span><span class="n">left_motor</span><span class="o">.</span><span class="n">position</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">no_of_degrees</span><span class="p">:</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Position: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tank_steering</span><span class="o">.</span><span class="n">left_motor</span><span class="o">.</span><span class="n">position</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>When I ran the program, it did pretty well, running between the lines and stopping maybe just a fraction too long.</p>
</div>
</div>
</div>
<div class="section" id="measuring-the-width-of-a-coloured-track">
<h2>3.4 Measuring the width of a coloured track<a class="headerlink" href="#measuring-the-width-of-a-coloured-track" title="Permalink to this headline">¶</a></h2>
<p>One of the activities in the Open University <a class="reference external" href="http://www.open.ac.uk/jobs/residential-schools/modules/modules-summer-schools/txr120-engineering-active-introduction">T176 <em>Engineering</em> residential school</a> is a robotics challenge to recreate a test track that depicts several coloured bands of various widths purely from data logged by an EV3 Lego robot.</p>
<p>Let’s try a related, but slightly simpler challenge: identifying the width of the track that is displayed on the <em>Loop</em> background.</p>
<div class="section" id="using-logged-data-to-take-measurements-from-the-simulated-world-optional">
<h3>3.4.1 Using logged data to take measurements from the simulated world (optional)<a class="headerlink" href="#using-logged-data-to-take-measurements-from-the-simulated-world-optional" title="Permalink to this headline">¶</a></h3>
<p>In this activity, you will use data logged by the robot to learn something about the structure of the world it is operating in.</p>
<p>Clear the data from the datalog:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">sim_data</span> <span class="o">--</span><span class="n">clear</span>
</pre></div>
</div>
</div>
</div>
<p>Then download and run the following program in the simulator to drive the robot over the test track.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sim_magic_preloaded</span> <span class="o">-</span><span class="n">C</span> <span class="o">-</span><span class="n">b</span> <span class="n">Loop</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="n">SAMPLE_TIME</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">tank_steering</span><span class="o">=</span> <span class="n">MoveSteering</span><span class="p">(</span><span class="n">OUTPUT_B</span><span class="p">,</span> <span class="n">OUTPUT_C</span><span class="p">)</span>

<span class="c1"># Define a light sensor</span>
<span class="n">colorLeft</span> <span class="o">=</span> <span class="n">ColorSensor</span><span class="p">(</span><span class="n">INPUT_2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">datalogger</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Simple datalogging function.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wheel_left: </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tank_steering</span><span class="o">.</span><span class="n">left_motor</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">get_clock</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Light_left: </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">colorLeft</span><span class="o">.</span><span class="n">full_reflected_light_intensity</span><span class="p">,</span> <span class="n">get_clock</span><span class="p">()))</span>
    <span class="n">sleep</span><span class="p">(</span><span class="n">SAMPLE_TIME</span><span class="p">)</span>
    
<span class="n">tank_steering</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="k">while</span> <span class="nb">int</span><span class="p">(</span><span class="n">tank_steering</span><span class="o">.</span><span class="n">left_motor</span><span class="o">.</span><span class="n">position</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1000</span><span class="p">:</span>
    <span class="n">datalogger</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>From a chart display of the data, such as the one that is generated if you run the code cell below, how might you identify the width of the black line?</p>
<p><em>Hint: in the interactive plotly chart, if you hover over the chart to raise the plotly toolbar then you can select <code class="docutils literal notranslate"><span class="pre">Compare</span> <span class="pre">data</span> <span class="pre">on</span> <span class="pre">hover</span></code> to report the line values for a particular x-axis value; the <code class="docutils literal notranslate"><span class="pre">Toggle</span> <span class="pre">Spike</span> <span class="pre">Lines</span></code> view will also show dynamic crosslines highlighting the current x- and y-values.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;plotly&quot;</span>

<span class="c1"># Grab the logged data into a pandas dataframe</span>
<span class="n">df_line</span> <span class="o">=</span> <span class="o">%</span><span class="n">sim_data</span>

<span class="c1"># Generate a line chart from the datalog dataframe</span>
<span class="n">df_line</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em>How can you use the logged data displayed in the chart above, or otherwise, to work out how wide the black line is? What other information, if any, do you need in order to express this as a distance in (simulated) metres?</em></p>
<p><em>Record your observations here.</em></p>
<div class="section" id="id2">
<h4>Example observations<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p><em>Click on the arrow in the sidebar or run this cell to reveal some example observations.</em></p>
<p>The chart shows the increasing trace from the position sensor and another trace for the light sensor. The light sensor value dips from 100 to 0 as the robot goes over the black line, then goes back to 100.</p>
<p>The horizontal <em>x</em>-axis is simulator time. If we take the position count reading at the same time that the robot detects the black line, and again at the same time that the robot crosses back onto the white background, then we can subtract the first position value from the second to give use the distance travelled by the robot.</p>
<p>To convert this to simulated metres, we would need to know what distance is travelled for a motor position increment value of 1.</p>
<p>If the position count is an angular measure (for example, degrees of wheel turn), then we could calculate the distance travelled as:</p>
<p><code class="docutils literal notranslate"><span class="pre">wheel_circumference</span> <span class="pre">*</span> <span class="pre">degrees_turned</span> <span class="pre">/</span> <span class="pre">360</span></code></p>
<p>since the distance travelled by the wheel in one complete turn is the same as its circumference.</p>
<p>We could calculate the circumference as:</p>
<p><code class="docutils literal notranslate"><span class="pre">wheel_circumference</span> <span class="pre">=</span> <span class="pre">2</span> <span class="pre">*</span> <span class="pre">wheel_radius</span> <span class="pre">*</span> <span class="pre">pi</span></code></p>
<p>or:</p>
<p><code class="docutils literal notranslate"><span class="pre">wheel_circumference</span> <span class="pre">=</span> <span class="pre">wheel_diameter</span> <span class="pre">*</span> <span class="pre">pi</span></code></p>
<p>both of which could be measured from the robot <em>if</em> we had physical access to it.</p>
</div>
</div>
</div>
<div class="section" id="summary">
<h2>3.5 Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>In this notebook you have seen how the motor <code class="docutils literal notranslate"><span class="pre">position</span></code> tachometer can be used to record how far, in fractions of a turn, each motor has turned. Moving forwards increases the motor tacho counts, whereas reversing reduces them both; turning increases one whilst reducing the other.</p>
<p>Tacho counts are very useful for providing an indicative feel for how a robot has travelled, but they may not be particularly accurate. As with many data traces, <em>trends</em> and <em>differences</em> often tell us much of what we need to know.</p>
<p>Through working with the motors and sensors at quite a low level, you have also started to learn how the implementation of the simulator itself may affect the performance of our programs. In certain cases, we may even have to do things in the program code that are there simply to accommodate some ‘feature’ of the way the simulator is implemented that would not occur in the real robot. In the physical world, time flows continuously of its own accord – in real time! In the simulator, we simulate it in discrete steps, which may even take longer to compute than the amount of time the step is supposed to represent.</p>
<p>In the next notebook, you will review another sensor that helps our robot know where it’s going: the gyro sensor.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./06. Where in the world are we"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="06.2%20Runaround.html" title="previous page">2 Runaround</a>
    <a class='right-next' id="next-link" href="06.4%20Keeping%20track%20of%20direction.html" title="next page">4 Keeping track of direction – which way are we heading?</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>