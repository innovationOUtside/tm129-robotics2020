
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>4 Robot sensors and data logging &#8212; TM129 Robotics Practical Activities</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="1 Introduction to program control flow" href="../03.%20Controlling%20program%20execution%20flow/03.1%20Program%20control%20using%20for%20loops.html" />
    <link rel="prev" title="3.1 Constants and variables in programs" href="02.3%20General%20programming%20concepts.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      <h1 class="site-logo" id="site-title">TM129 Robotics Practical Activities</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../README_FIRST.html">
   Welcome to the TM129 Robotics block
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../00_FOR_VLE/Section_00_01_Introduction.html">
   1 Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../00_NOTES_FOR_TUTORS/GETTING_STARTED.html">
   Getting started
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01.%20Introducing%20notebooks%20and%20the%20RoboLab%20environment/01.1%20Jupyter%20environment.html">
   1 Introduction to the TM129 Jupyter notebook environment
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01.%20Introducing%20notebooks%20and%20the%20RoboLab%20environment/01.2%20Exploring%20the%20notebook%20environment.html">
     2 The interactive read-writable notebook environment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01.%20Introducing%20notebooks%20and%20the%20RoboLab%20environment/01.3%20Introducing%20nbev3devsim.html">
     3 The RoboLab simulated on-screen robot (
     <code class="docutils literal notranslate">
      <span class="pre">
       nbev3devsim
      </span>
     </code>
     )
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01.%20Introducing%20notebooks%20and%20the%20RoboLab%20environment/01.4%20Exploring%20nbev3devsim.html">
     4 Exploring the
     <code class="docutils literal notranslate">
      <span class="pre">
       nbev3devsim
      </span>
     </code>
     simulator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01.%20Introducing%20notebooks%20and%20the%20RoboLab%20environment/01.5%20Example%20robot%20program.html">
     5 An example robot program
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01.%20Introducing%20notebooks%20and%20the%20RoboLab%20environment/01.6%20Working%20With%20Simulators.html">
     6 Working with simulators
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="02.1%20Robot%20programming%20constructs.html">
   1 An introduction to programming robots
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="02.2%20Creating%20your%20own%20robot%20programs.html">
     2 Creating your own robot programs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02.3%20General%20programming%20concepts.html">
     3.1 Constants and variables in programs
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     4 Robot sensors and data logging
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.1%20Program%20control%20using%20for%20loops.html">
   1 Introduction to program control flow
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.2%20Program%20control%20using%20while%20loops%20and%20blocking.html">
     2 Program control flow using a
     <code class="docutils literal notranslate">
      <span class="pre">
       while...
      </span>
     </code>
     loop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.3%20Program%20control%20flow%20using%20branches.html">
     3 Branches
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.4%20Example%20robot%20control%20programs.html">
     4 Example robot control programs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.5%20Some%20RoboLab%20challenges.html">
     5 RoboLab challenges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03.%20Controlling%20program%20execution%20flow/03.6%20Optional%20RoboLab%20challenges.html">
     6 Optional challenges
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04.%20Not%20quite%20intelligent%20robots/04.1%20Introducing%20program%20functions.html">
   1 Introduction to functions and robot control strategies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04.%20Not%20quite%20intelligent%20robots/04.2%20Robot%20navigation%20using%20dead%20reckoning.html">
     2 Dead reckoning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04.%20Not%20quite%20intelligent%20robots/04.3%20Emergent%20robot%20behaviour%20and%20simple%20data%20charts.html">
     3 Emergent robot behaviour and simple data charts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04.%20Not%20quite%20intelligent%20robots/04.4%20Reasoning%20with%20Eliza.html">
     4 Reasoning with Eliza
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04.%20Not%20quite%20intelligent%20robots/04.5%20Reasoning%20with%20rule%20based%20systems.html">
     5 Reasoning with rule-based systems – Durable Rules Engine
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05.%20Experimenting%20with%20sensors/05.1%20Introducing%20sensor%20based%20control.html">
   Introduction to sensor-based control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../06.%20Where%20in%20the%20world%20are%20we/06.1%20Introducing%20sensor%20based%20navigation.html">
   Introducing sensor-based navigation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07.%20Neural%20networks/07.1%20Introducing%20neural%20networks.html">
   1 Introducing neural networks
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.1%20Introducing%20remote%20services%20and%20multi-agent%20systems.html">
   1 An introduction to remote services and multi-agent systems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.2%20Collecting%20digit%20image%20and%20class%20data%20from%20the%20simulator.html">
     2 Collecting digit image and class data from the simulator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.3%20Recognising%20digits%20using%20a%20convolutional%20neural%20network%20%28optional%29.html">
     3 Recognising digits using a convolutional neural network (optional)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.4%20Recognising%20patterns%20on%20the%20move.html">
     4 Recognising patterns on the move
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.5%20Messaging%20in%20multi-agent%20systems.html">
     5 Messaging in multi-agent systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08.%20Remote%20services%20and%20multi-agent%20systems/08.6%20Conclusion.html">
     6 Conclusion
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/02. Getting started with robot and Python programming/02.4 Getting started with sensors.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/02. Getting started with robot and Python programming/02.4 Getting started with sensors.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#previewing-sensor-values">
   4.1 Previewing sensor values
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#investigating-the-light-sensor">
   4.2 Investigating the light sensor
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-the-light-sensor-as-a-low-resolution-camera">
     4.2.1 Using the light sensor as a low-resolution camera
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#updating-variables-from-sensor-values">
   4.3 Updating variables from sensor values
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#activity-experimenting-with-the-light-sensor">
     4.3.1 Activity – Experimenting with the light sensor
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#example-solution">
       Example solution
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#identifying-colour-values">
     4.3.2 Identifying colour values
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#logging-data-from-the-light-sensor">
   4.4 Logging data from the light sensor
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#viewing-the-logged-data-using-a-chart-display">
   4.5 Viewing the logged data using a chart display
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#activity-viewing-sensor-data-in-a-line-chart">
     4.5.1 Activity – Viewing sensor data in a line chart
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Example solution
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#viewing-the-logged-data-uploading-the-logged-data-to-the-notebook">
   4.6 Viewing the logged data – Uploading the logged data to the notebook
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clearing-the-simulated-robots-datalog">
     4.6.1 Clearing the simulated robot’s datalog
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#retrieving-data-from-the-simulated-robots-datalog">
     4.6.2 Retrieving data from the simulated robot’s datalog
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualising-data-retrieved-from-the-simulated-robot-datalog-using-a-seaborn-line-chart">
     4.6.3 Visualising data retrieved from the simulated robot datalog using a
     <code class="docutils literal notranslate">
      <span class="pre">
       seaborn
      </span>
     </code>
     line chart
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generating-additional-chart-types-from-the-same-dataset">
     4.6.4 Generating additional chart types from the same dataset
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   4.7 Summary
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="robot-sensors-and-data-logging">
<h1>4 Robot sensors and data logging<a class="headerlink" href="#robot-sensors-and-data-logging" title="Permalink to this headline">¶</a></h1>
<p>In this notebook, you will start to learn how to work with one of the sensors provided in our robot simulator, as well as how to collect data from it for further analysis or visualisation.</p>
<p>In particular, we will focus on the light sensor, using it to demonstrate the various ways we can capture, report and make use of sensor information in RoboLab.</p>
<p>Before we get started, load in the simulator in the normal way:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nbev3devsim.load_nbev3devwidget</span> <span class="kn">import</span> <span class="n">roboSim</span><span class="p">,</span> <span class="n">eds</span>
<span class="o">%</span><span class="n">load_ext</span> <span class="n">nbev3devsim</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="previewing-sensor-values">
<h2>4.1 Previewing sensor values<a class="headerlink" href="#previewing-sensor-values" title="Permalink to this headline">¶</a></h2>
<p>The <em>Instrumentation</em> panel provides information regarding sensor and motor readings.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LeftMotor</span></code> / <code class="docutils literal notranslate"><span class="pre">RightMotor</span></code> report tachometer counts for each motor</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Sensor1</span></code> / <code class="docutils literal notranslate"><span class="pre">Sensor2</span></code> report left and right light sensor values as follows: reflected light percentage for the red component range 0…100; average reflected light percentage over all three RGB components range 0…100; 3-tuple of RGB values, each in range 0…255</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Ultrasonic</span></code>: distance reading to obstacle</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Gyro</span></code>: the <em>angle</em> in degrees since the sensor was initialised and the <em>rate</em> at which the sensor is rotating, in degrees/second.</p></li>
</ul>
<p>Run the following code cell with the <code class="docutils literal notranslate"><span class="pre">--instrumentation</span></code> / <code class="docutils literal notranslate"><span class="pre">-i</span></code> simulator magic flag to show the <em>Instrumentation</em> panel and the <em>Rainbow_bands</em> background preloaded. Click and drag the simulated robot, or use the <em>Position controls</em> (<code class="docutils literal notranslate"><span class="pre">-X</span></code>), to move the robot around the testcard, observing how the sensor values are updated as you do so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">sim_magic</span> <span class="o">-</span><span class="n">b</span> <span class="n">Rainbow_bands</span> <span class="o">-</span><span class="n">H</span> <span class="o">--</span><span class="n">instrumentation</span>
</pre></div>
</div>
</div>
</div>
<p><em>Record your own observations about the sensor readings over various coloured background stripes here.</em></p>
</div>
<div class="section" id="investigating-the-light-sensor">
<h2>4.2 Investigating the light sensor<a class="headerlink" href="#investigating-the-light-sensor" title="Permalink to this headline">¶</a></h2>
<p>One of the things that distinguishes robot control programs from many other sorts of program is that robots typically have a range of <em>sensors</em> available to them. Readings taken from these sensors can be referenced from within the robot control program and used to inform or determine the actions it takes.</p>
<p>To begin with, you will experiment with a simulated downward light sensor that can take readings from the simulator world background as it drives over it.</p>
<p>The simulated sensor we are using is based on the Lego light sensor:</p>
<p><img alt="*A Lego light sensor. This is a custom packaged sensor with a Technic Lego connector on the base. Two small lenses are visible in the front face of the sensor brick. A large clear lens is the light sensor itself. Below it is a lens that can be used as a light source to illuminate a surface. The light sensor then measures light reflected from the surface rather than ambient light levels." src="../_images/ev3_light_sensor.png" /></p>
<p>The light sensor measures light across three channels: <em>red</em>, <em>green</em> and <em>blue</em>. The light sensor returns information about the reflected light in various ways.</p>
<p>Some of these are referenced in the robot control programs as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.rgb</span></code>: as a list of raw values, <code class="docutils literal notranslate"><span class="pre">[red,</span> <span class="pre">green,</span> <span class="pre">blue]</span></code>, each value representing an integer in the range 0…255</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.reflected_light_intensity</span></code>: an integer in the range 0…255 representing the red component of the full RGB response</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.reflected_light_intensity_pc</span></code>: a floating-point number in the range 0…100.0 representing the reflected light intensity as a percentage</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.full_reflected_light_intensity</span></code>: a floating-point number in the range 0…100.0 representing the reflected light intensity averaged over all three RGB channels, as a percentage</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.color</span></code> / <code class="docutils literal notranslate"><span class="pre">.color_name</span></code>: a colour value in the range 1…7 (representing: black, blue, green, yellow, red, white, brown), or the corresponding colour name.</p></li>
</ul>
<p>We can remind ourselves how the sensors are defined by previewing the boilerplate code added by the magics:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">sim_magic_preloaded</span> <span class="o">-</span><span class="n">v</span>
</pre></div>
</div>
</div>
</div>
<p>In this case, we have defined the left colour sensor as <code class="docutils literal notranslate"><span class="pre">colorLeft</span></code> so within a robot control program we might lookup a sensor value as <code class="docutils literal notranslate"><span class="pre">colorLeft.reflected_light_intensity</span></code> or <code class="docutils literal notranslate"><span class="pre">colorLeft.reflected_light_intensity_pc</span></code> for example.</p>
<div class="section" id="using-the-light-sensor-as-a-low-resolution-camera">
<h3>4.2.1 Using the light sensor as a low-resolution camera<a class="headerlink" href="#using-the-light-sensor-as-a-low-resolution-camera" title="Permalink to this headline">¶</a></h3>
<p>The way each light sensor is implemented by the simulator is as a simple quantised circular area of pixels, each of which returns an RGB value. The value returned by the sensor is then some function of the individual array values.</p>
<p><em>In fact, the function is a simple average (mean) value, but other strategies are available, including weighted averages, where we weight values returned by pixels in the central focal array of the array more heavily than ‘out of focus’ or ‘peripheral vision’ pixels at the edge of the array, for example.</em></p>
<p>You can preview the sensor array view using the <em>Sensor arrays</em> panel raised via the <code class="docutils literal notranslate"><span class="pre">--array</span></code> / <code class="docutils literal notranslate"><span class="pre">-A</span></code> magic switch.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">sim_magic</span> <span class="o">-</span><span class="n">b</span> <span class="n">Testcard</span> <span class="o">-</span><span class="n">H</span> <span class="o">--</span><span class="n">array</span> 
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="updating-variables-from-sensor-values">
<h2>4.3 Updating variables from sensor values<a class="headerlink" href="#updating-variables-from-sensor-values" title="Permalink to this headline">¶</a></h2>
<p>Load the <em>Grey_bands</em> background in to the simulator, and download and run the following program.</p>
<p>Observe the values that are displayed in the simulator output window.</p>
<p>You may also choose to monitor the values via the <em>Instrumentation</em> and <em>Sensor arrays</em> panels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sim_magic_preloaded</span> <span class="o">-</span><span class="n">b</span> <span class="n">Grey_bands</span> <span class="o">--</span><span class="n">output</span> <span class="o">-</span><span class="n">RH</span>

<span class="c1"># Explicitly set up the colour sensor</span>
<span class="kn">from</span> <span class="nn">ev3dev2.sensor</span> <span class="kn">import</span> <span class="n">INPUT_2</span>
<span class="n">colorLeft</span> <span class="o">=</span> <span class="n">ColorSensor</span><span class="p">(</span><span class="n">INPUT_2</span><span class="p">)</span>

<span class="n">tank_drive</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
              <span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

<span class="n">sensor_value</span> <span class="o">=</span> <span class="n">colorLeft</span><span class="o">.</span><span class="n">reflected_light_intensity_pc</span>

<span class="k">while</span> <span class="n">sensor_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sensor_value</span><span class="p">)</span>
    <span class="n">sensor_value</span> <span class="o">=</span> <span class="n">colorLeft</span><span class="o">.</span><span class="n">reflected_light_intensity_pc</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I now see </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">sensor_value</span><span class="p">))</span>
<span class="n">tank_drive</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>In the program the <code class="docutils literal notranslate"><span class="pre">colorLeft.reflected_light_intensity_pc</span></code> element represents a variable that describes the current value of a particularly configured robot sensor. We then set another variable, <code class="docutils literal notranslate"><span class="pre">sensor_value</span></code> equal to the value of that sensor variable.</p>
<p>From the simulator output display, we see that the <code class="docutils literal notranslate"><span class="pre">sensor_value</span></code> changes as the robot crosses the grey lines. But there is nothing explicitly stated in the program where <em>we</em> update the <code class="docutils literal notranslate"><span class="pre">colorLeft.reflected_light_intensity_pc</span></code> value. Rather, its value is updated ‘live’ from a regular poll of the sensor within the simulator.</p>
<p><em>By polling a sensor, we mean that a reading is taken from the sensor (somehow!) and used to set the value of a variable associated with that sensor so we can make decisions based on the sensor value from within our robot control program.</em></p>
<div class="section" id="activity-experimenting-with-the-light-sensor">
<h3>4.3.1 Activity – Experimenting with the light sensor<a class="headerlink" href="#activity-experimenting-with-the-light-sensor" title="Permalink to this headline">¶</a></h3>
<p>In this activity you will explore the range of values returned by the light sensor.</p>
<p>Load the <em>Grey_bands</em> background into the simulator and then click and drag the simulated robot over each coloured band.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">sim_magic</span> <span class="o">-</span><span class="n">b</span> <span class="n">Grey_bands</span>
</pre></div>
</div>
</div>
</div>
<p>Alternatively use the simulator magic to move it to the various locations <code class="docutils literal notranslate"><span class="pre">-y</span> <span class="pre">500</span></code> and <code class="docutils literal notranslate"><span class="pre">-x</span></code> taking values in <code class="docutils literal notranslate"><span class="pre">[125,</span> <span class="pre">325,</span> <span class="pre">725,</span> <span class="pre">1125,</span> <span class="pre">1525]</span></code>.</p>
<p>Record the sensor values displayed in each case. You can identify these values:</p>
<ul class="simple">
<li><p>from the simulator widget user interface by opening the <em>Instrumentation</em> panel</p></li>
<li><p>from the simulator widget output window if you run a program to print the values there</p></li>
<li><p>from a notebook code cell by synchronising the robot state and then displaying the required data values.</p></li>
</ul>
<p>What value does the sensor give when the robot is placed on the white background? What sensor values are returned when the light sensor is over each of the light grey, medium grey, dark grey and black bands?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sim_magic_preloaded</span> <span class="o">-</span><span class="n">b</span> <span class="n">Grey_bands</span> <span class="o">-</span><span class="n">y</span> <span class="mi">500</span> <span class="o">-</span><span class="n">x</span> <span class="mi">875</span> <span class="o">-</span><span class="n">R</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">colorLeft</span><span class="o">.</span><span class="n">rgb</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reflected light intensity&#39;</span><span class="p">,</span>
      <span class="n">colorLeft</span><span class="o">.</span><span class="n">reflected_light_intensity</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reflected light intensity per cent&#39;</span><span class="p">,</span>
      <span class="n">colorLeft</span><span class="o">.</span><span class="n">reflected_light_intensity_pc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Full reflected light intensity (%)&#39;</span><span class="p">,</span>
      <span class="n">colorLeft</span><span class="o">.</span><span class="n">full_reflected_light_intensity</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Colour&#39;</span><span class="p">,</span> <span class="n">colorLeft</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Colour name&#39;</span><span class="p">,</span> <span class="n">colorLeft</span><span class="o">.</span><span class="n">color_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em>Double-click this cell to edit it and add your recorded sensor values here:</em></p>
<ul class="simple">
<li><p>white background:</p></li>
<li><p>light grey band:</p></li>
<li><p>medium grey band:</p></li>
<li><p>dark grey band:</p></li>
<li><p>black band:</p></li>
</ul>
<p>Now load the <em>Rainbow_bands</em> background into the simulator and then click and drag the simulated robot over each coloured band (or move it to the various locations <code class="docutils literal notranslate"><span class="pre">-y</span> <span class="pre">500</span></code> and <code class="docutils literal notranslate"><span class="pre">-x</span></code> taking values in <code class="docutils literal notranslate"><span class="pre">[125,</span> <span class="pre">325,</span> <span class="pre">725,</span> <span class="pre">1125,</span> <span class="pre">1525]</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">sim_magic</span> <span class="o">-</span><span class="n">b</span> <span class="n">Rainbow_bands</span>
</pre></div>
</div>
</div>
</div>
<p>What value does the sensor give when the robot is placed on each of the coloured backgrounds?</p>
<p>Do you notice anything strange about the sensor values, particularly when the robot is close to the edge of a particular band?</p>
<p><em>Double-click this cell to edit it and add your recorded sensor values here:</em></p>
<ul class="simple">
<li><p>white background:</p></li>
<li><p>light grey band:</p></li>
<li><p>medium grey band:</p></li>
<li><p>dark grey band:</p></li>
<li><p>black band:</p></li>
</ul>
<div class="section" id="example-solution">
<h4>Example solution<a class="headerlink" href="#example-solution" title="Permalink to this headline">¶</a></h4>
<p><em>Click the arrow in the sidebar or run this cell to reveal an example solution.</em></p>
<p>I get the following readings for the reflected light intensity readings from the light sensor:</p>
<ul class="simple">
<li><p>white background: <code class="docutils literal notranslate"><span class="pre">100</span></code></p></li>
<li><p>light grey band: <code class="docutils literal notranslate"><span class="pre">~86</span></code></p></li>
<li><p>medium grey band: <code class="docutils literal notranslate"><span class="pre">~82</span></code></p></li>
<li><p>dark grey band: <code class="docutils literal notranslate"><span class="pre">~50</span></code></p></li>
<li><p>black band: <code class="docutils literal notranslate"><span class="pre">0</span></code></p></li>
</ul>
<p>There is some ‘noise’ in the form of intermediate values as the robot goes into and leaves the band. This is because the sensor has a ‘width’ so it may be averaging readings where part of the sensor is over the white background and part of it is over the coloured band.</p>
</div>
</div>
<div class="section" id="identifying-colour-values">
<h3>4.3.2 Identifying colour values<a class="headerlink" href="#identifying-colour-values" title="Permalink to this headline">¶</a></h3>
<p>As we well displaying raw RGB values, we can also report on colour values.</p>
<p>Run the following magic to load in a program that speaks the colour value and colour name of the current colour seen by the left colour sensor:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sim_magic_preloaded</span> <span class="o">-</span><span class="n">b</span> <span class="n">Rainbow_bands</span>

<span class="n">colorval</span> <span class="o">=</span>  <span class="n">colorLeft</span><span class="o">.</span><span class="n">color</span>
<span class="n">colorname</span> <span class="o">=</span> <span class="n">colorLeft</span><span class="o">.</span><span class="n">color_name</span>

<span class="n">say</span><span class="p">(</span><span class="n">colorval</span><span class="p">)</span>
<span class="n">say</span><span class="p">(</span><span class="n">colorname</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I see&quot;</span> <span class="o">+</span> <span class="n">colorname</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">colorval</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now run the following command to autorun the program at specified locations of that background:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run this cell several time with</span>
<span class="c1"># with a different value of x each time:</span>
<span class="c1"># x: 100, 300 500, 700, 900, 1100, 1300, 1500</span>
<span class="o">%</span><span class="n">sim_magic</span> <span class="o">--</span><span class="n">autorun</span> <span class="o">--</span><span class="n">xpos</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="logging-data-from-the-light-sensor">
<h2>4.4 Logging data from the light sensor<a class="headerlink" href="#logging-data-from-the-light-sensor" title="Permalink to this headline">¶</a></h2>
<p>In the simulator, the <em>Grey_bands</em> background displays a white background overlaid by four grey bars of different intensity, ranging from a pale grey to black.</p>
<p>The following program could be used to drive the simulated robot over the background, logging the light sensor data as it does so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import require components</span>
<span class="kn">from</span> <span class="nn">ev3dev2.motor</span> <span class="kn">import</span> <span class="n">MoveTank</span><span class="p">,</span> <span class="n">SpeedPercent</span><span class="p">,</span> <span class="n">OUTPUT_B</span><span class="p">,</span> <span class="n">OUTPUT_C</span>
<span class="kn">from</span> <span class="nn">ev3dev2.sensor</span> <span class="kn">import</span> <span class="n">INPUT_1</span><span class="p">,</span> <span class="n">INPUT_2</span><span class="p">,</span> <span class="n">INPUT_3</span><span class="p">,</span> <span class="n">INPUT_4</span>
<span class="kn">from</span> <span class="nn">ev3dev2.sensor.lego</span> <span class="kn">import</span> <span class="n">ColorSensor</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="c1"># Create tank drive and colour sensor references</span>
<span class="n">tank_drive</span> <span class="o">=</span> <span class="n">MoveTank</span><span class="p">(</span><span class="n">OUTPUT_B</span><span class="p">,</span> <span class="n">OUTPUT_C</span><span class="p">)</span>
<span class="n">colorLeft</span> <span class="o">=</span> <span class="n">ColorSensor</span><span class="p">(</span><span class="n">INPUT_2</span><span class="p">)</span>

<span class="c1"># Start the robot driving forwards</span>
<span class="n">tank_drive</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

<span class="c1"># Blocking sample rate for sampling sensor value</span>
<span class="n">sample_period</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="c1"># Run the following loop</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># Log the colour sensor data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Colour: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">colorLeft</span><span class="o">.</span><span class="n">reflected_light_intensity_pc</span> <span class="p">))</span>
    
    <span class="c1"># If we see black, break out of the loop</span>
    <span class="k">if</span> <span class="n">sensor_val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">sleep</span><span class="p">(</span><span class="n">sample_period</span><span class="p">)</span>
        
<span class="n">say</span><span class="p">(</span><span class="s2">&quot;All done.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can also use the <code class="docutils literal notranslate"><span class="pre">%%sim_magic_preloaded</span></code> magic to preload the drive and sensor configurations and references to minimise the clutter in <em>our</em> code, whilst remembering that it is still required for the program to run, and will be loaded in automatically by the magic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">sim_magic_preloaded</span> <span class="o">--</span><span class="n">background</span> <span class="n">Grey_bands</span> <span class="o">-</span><span class="n">OHR</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="c1"># Start the robot driving forwards</span>
<span class="c1"># using the preloaded tank_drive definition</span>
<span class="n">tank_drive</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
              <span class="n">SpeedPercent</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

<span class="c1"># Blocking sample rate for sampling sensor value</span>
<span class="n">sample_period</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">sensor_val</span> <span class="o">=</span> <span class="n">colorLeft</span><span class="o">.</span><span class="n">reflected_light_intensity_pc</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Colour: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span> <span class="n">sensor_val</span><span class="p">))</span>
    
    <span class="c1"># If we see black, break out of the loop</span>
    <span class="k">if</span> <span class="n">sensor_val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">sleep</span><span class="p">(</span><span class="n">sample_period</span><span class="p">)</span>

<span class="n">say</span><span class="p">(</span><span class="s2">&quot;All done.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Run the previous code cell to download the program to the simulator and then run it in the simulator.</p>
<p>As the program runs, you should notice that a sequence of logged data values from the sensor are displayed in the output window. If you scroll up through the display in that window you should notice that the sensor values changed as the robot crossed over each grey line.</p>
</div>
<div class="section" id="viewing-the-logged-data-using-a-chart-display">
<h2>4.5 Viewing the logged data using a chart display<a class="headerlink" href="#viewing-the-logged-data-using-a-chart-display" title="Permalink to this headline">¶</a></h2>
<p>As well as taking the sensor readings directly, we can also read them from a chart created in real time from the logged data.</p>
<p>By monitoring the output display for print messages that log sensor outputs using a particular message format, particular messages can be automatically parsed and used to extract data values so that they can be displayed on a dynamically updated line chart.</p>
<div class="section" id="activity-viewing-sensor-data-in-a-line-chart">
<h3>4.5.1 Activity – Viewing sensor data in a line chart<a class="headerlink" href="#activity-viewing-sensor-data-in-a-line-chart" title="Permalink to this headline">¶</a></h3>
<p>Enable the inline interactive simulator data charter by clicking the <em>Chart</em> toggle display button in the simulator, then ensure that the <em>Colour</em> trace checkbox is ticked.</p>
<p>Reset the start location of the robot by dragging it back to the start position or using the <em>Position controls</em> sliders.</p>
<p>Using the <em>Simulator controls</em>, click the <em>Run</em> button or use the simulator keyboard shortcut (<code class="docutils literal notranslate"><span class="pre">R</span></code>) to run the simulator data collection program again.</p>
<p><em>Note that the simulator might run quite slowly as it updates the chart.</em></p>
<p>Observe how the chart is updated with the live sensor values. Can you see where the robot encounters the different coloured bands? What values are recorded for each band?</p>
<p><em>If the chart does not update, check that the <code class="docutils literal notranslate"><span class="pre">Colour</span></code> checkbox is selected. If it is and there is still no chart display, close the <code class="docutils literal notranslate"><span class="pre">Chart</span></code> panel and then open it again, press the <code class="docutils literal notranslate"><span class="pre">Clear</span> <span class="pre">Chart</span></code> button, wait a moment or two for the chart to reload and then try to run the program again.</em></p>
<p>From the chart, can you read off the values for each band?</p>
<p><em>Double-click this cell to edit it and add your recorded sensor values here:</em></p>
<ul class="simple">
<li><p>white background:</p></li>
<li><p>light grey band:</p></li>
<li><p>medium grey band:</p></li>
<li><p>dark grey band:</p></li>
<li><p>black band:</p></li>
</ul>
<div class="section" id="id1">
<h4>Example solution<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p><em>Click the arrow in the sidebar or run this cell to reveal an example solution.</em></p>
<p>The following diagram shows the result of showing the real-time data logging chart:</p>
<p><img alt="The simulator Data log window, with a graph showing sensor data. The graph has a vertical axis with a scale that runs from 0 to 250, and a horizontal axis that runs from 0 to 400. A line chart is plotted showing successive sensor readings. Reading the graph from left (the first sensor reading) to right (the last sensor reading), the line is horizontal at a y-value of 255 until an x-value of about 100, followed by a drop to about 220 until about x=145, at which point it climbs steeply back up to y=255, remaining at that level until about x=190. There is a further sharp drop to about (x, y) equal to (190, 210), then back up to 255 at about x=225, until another edge at about x=280 down to (280, 130); the chart then goes back up from about (320, 130) to (321, 255), then down to y=0 at about x=360, staying then until x is almost 410, at which point the line climbs back up to 255, stays there for a short while, and the trace ends." src="../_images/Section_00_03_-_charting.png" /></p>
<p>As the robot progresses across the bands, the bars that it encounters get progressively darker, so the sensor readings reduce. Between the bands, as the robot crosses the white background, the sensor reading go back up to their initial, maximum reading.</p>
<p>If you hover your cursor over the chart, all the recorded trace values at that x-position on the chart are displayed. These are the values that were recorded and displayed, taken from the midpoint of the chart, when I ran the experiment:</p>
<ul class="simple">
<li><p>white background: <code class="docutils literal notranslate"><span class="pre">100</span></code></p></li>
<li><p>light grey band: <code class="docutils literal notranslate"><span class="pre">86.27451</span></code></p></li>
<li><p>medium grey band: <code class="docutils literal notranslate"><span class="pre">82.7451</span></code></p></li>
<li><p>dark grey band: <code class="docutils literal notranslate"><span class="pre">50.19608</span></code></p></li>
<li><p>black band: <code class="docutils literal notranslate"><span class="pre">0</span></code></p></li>
</ul>
<p><em>(You may have noticed that the simulation runs in a slightly more ‘stuttery’ way than when the chart is not displayed as your computer has to do more work in terms of dynamically updating the chart. Increasing the <code class="docutils literal notranslate"><span class="pre">sample_period</span></code> time should improve this but at the cost of collecting less data.</em></p>
</div>
</div>
</div>
<div class="section" id="viewing-the-logged-data-uploading-the-logged-data-to-the-notebook">
<h2>4.6 Viewing the logged data – Uploading the logged data to the notebook<a class="headerlink" href="#viewing-the-logged-data-uploading-the-logged-data-to-the-notebook" title="Permalink to this headline">¶</a></h2>
<p>As well as inspecting the datalog values in the simulator output window and via the embedded datalog chart, we can also export the logged data from the simulator into the Python environment used by the notebook. This then allows us to analyse and chart the data within a complete Python environment.</p>
<p>The following code cell shows how to access the datalog from the simulator in the notebook’s Python environment. The <em>pandas</em> package is a very powerful package for working with tabular data.</p>
<p><em>You can learn more about using pandas from the OpenLearn unit <a class="reference external" href="https://www.open.edu/openlearn/science-maths-technology/learn-code-data-analysis/content-section-overview-0?active-tab=description-tab">Learn To code for data analysis</a> or as part of the Open University module <a class="reference external" href="http://www.open.ac.uk/courses/modules/tm351">Data management and analysis (TM351)</a>.</em></p>
<div class="section" id="clearing-the-simulated-robots-datalog">
<h3>4.6.1 Clearing the simulated robot’s datalog<a class="headerlink" href="#clearing-the-simulated-robots-datalog" title="Permalink to this headline">¶</a></h3>
<p>In order to view the data, let’s first clear the data using the <code class="docutils literal notranslate"><span class="pre">%sim_data</span></code> line magic with the <code class="docutils literal notranslate"><span class="pre">--clear</span></code> / <code class="docutils literal notranslate"><span class="pre">-c</span></code> switch:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">sim_data</span> <span class="o">--</span><span class="n">clear</span>
</pre></div>
</div>
</div>
</div>
<p>Now rerun the data collection program that collected the data from a traverse across the grey lines:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">sim_magic</span> <span class="o">-</span><span class="n">x</span> <span class="mi">100</span> <span class="o">--</span><span class="n">autorun</span> <span class="o">-</span><span class="n">W</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="retrieving-data-from-the-simulated-robots-datalog">
<h3>4.6.2 Retrieving data from the simulated robot’s datalog<a class="headerlink" href="#retrieving-data-from-the-simulated-robots-datalog" title="Permalink to this headline">¶</a></h3>
<p>Once you can see (or hear!) that the program has finished, run the following code cell to use the <code class="docutils literal notranslate"><span class="pre">%sim_data</span></code> line magic to grab the data from the datalog into the notebook’s own Python environment as a <em>pandas</em> dataframe and then associate it with the <code class="docutils literal notranslate"><span class="pre">data_df</span></code> variable running in the notebook’s own Python environment:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_df</span> <span class="o">=</span> <span class="o">%</span><span class="n">sim_data</span>
</pre></div>
</div>
</div>
</div>
<p>The dataframe is a powerful data structure that allows us to represent and work with tabular datasets. In certain repsoects, you might think of it providing a code-powered equivalent to a spreadsheet application such as Microsoft Excel.</p>
<p>We can preview the first few lines of the dataframe by running the following command:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><em>It is common parlance in computing circles to refer to the top, or first few lines, of a file as the <code class="docutils literal notranslate"><span class="pre">head</span></code> and the end, or last few lines, of a file as the <code class="docutils literal notranslate"><span class="pre">tail</span></code>.</em></p>
</div>
<div class="section" id="visualising-data-retrieved-from-the-simulated-robot-datalog-using-a-seaborn-line-chart">
<h3>4.6.3 Visualising data retrieved from the simulated robot datalog using a <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> line chart<a class="headerlink" href="#visualising-data-retrieved-from-the-simulated-robot-datalog-using-a-seaborn-line-chart" title="Permalink to this headline">¶</a></h3>
<p>With the data in a <em>pandas</em> dataframe, we can then use a variety of tools to generate our own charts from it.</p>
<p>One approach is to use the <em>seaborn</em> Python package to create a line chart directly from the dataframe.</p>
<p><em>The <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> package is one of many Python packages that supports the creation of a wide range of statistical and scientific chart types from <code class="docutils literal notranslate"><span class="pre">pandas</span></code> dataframes. See <a class="reference external" href="https://seaborn.pydata.org/"><code class="docutils literal notranslate"><span class="pre">seaborn</span></code> data visualization library</a> for more details.</em></p>
<p>By convention, when we import the <em>seaborn</em> package we create an alias name for it: <code class="docutils literal notranslate"><span class="pre">sns</span></code>.</p>
<p>In the following unmagicked, notebook Python code cell, the <em>seaborn</em> line plot charting function is selected (<code class="docutils literal notranslate"><span class="pre">sns.lineplot()</span></code>) and passed our datalog dataframe (<code class="docutils literal notranslate"><span class="pre">data=data_df</span></code>). The <em>index</em> column values in the dataframe are assigned to the <em>x</em>-axis (<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">&quot;index&quot;</span></code>) and the <em>value</em> column values to the <em>y</em>-axis (<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">&quot;value&quot;</span></code>). The line colour is generated from unique values identified in the <em>variable</em> column (<code class="docutils literal notranslate"><span class="pre">hue</span> <span class="pre">=</span> <span class="pre">&quot;variable&quot;</span></code>).</p>
<p><em>Note that in passing parameter values to the <code class="docutils literal notranslate"><span class="pre">lineplot()</span></code> function, we can use either single or double quotes to identify the column name as a string value. So for example, both <code class="docutils literal notranslate"><span class="pre">hue='variable'</span></code>, using single quotes (<code class="docutils literal notranslate"><span class="pre">'</span></code>) and <code class="docutils literal notranslate"><span class="pre">hue=&quot;variable&quot;</span></code>, using double quotes (<code class="docutils literal notranslate"><span class="pre">&quot;</span></code>), are equally valid.</em></p>
<p>If we had additional sensors identified using different <em>variable</em> values, such as <em>ultrasonic</em>, each sensor would have its own coloured line trace.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load in the seaborn charting package</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># Generate a line chart from the datalog dataframe</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
                  <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span>
                  <span class="c1"># The hue category defines line color</span>
                  <span class="n">hue</span> <span class="o">=</span> <span class="s1">&#39;variable&#39;</span><span class="p">,</span>
                  <span class="n">data</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em>If you have run the robot data collection program several times, the datalog will contain data from each of the runs. To ensure the datalog only contains data from a particular run, run the command <code class="docutils literal notranslate"><span class="pre">%sim_data</span> <span class="pre">--clear</span></code> in a notebook code cell before running the program in the simulator. Then run the program in the simulator to collect the data, and then grab the data into a dataframe.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Running this code cell will clear the robot&#39;s datalog</span>
<span class="o">%</span><span class="n">sim_data</span> <span class="o">--</span><span class="n">clear</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="generating-additional-chart-types-from-the-same-dataset">
<h3>4.6.4 Generating additional chart types from the same dataset<a class="headerlink" href="#generating-additional-chart-types-from-the-same-dataset" title="Permalink to this headline">¶</a></h3>
<p>As well generating charts using just the <em>seaborn</em> package, we can build up charts from several layers of data display. The following chart is constructed from a <em>seaborn</em> <code class="docutils literal notranslate"><span class="pre">FacetGrid</span></code> chart, which generates one line chart per sensor (as identifed from the <code class="docutils literal notranslate"><span class="pre">row</span> <span class="pre">=</span> <span class="pre">&quot;variable&quot;</span></code> parameter), and then overplots individual <code class="docutils literal notranslate"><span class="pre">x</span></code> markers, one per datapoint, using a <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> plotting function.</p>
<p><code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> is a relatively low-level charting library that gives us more control over simple items that make up a chart. The <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> package is itself built up from simpler <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> components and provides higher-level charting functions that allow us to create different chart types in a natural way from <em>pandas</em> dataframes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># A FacetGrid is a faceted display arranged in a grid</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">data_df</span><span class="p">,</span>
                  <span class="n">row</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> 
                  <span class="n">height</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                  <span class="c1"># Set the aspect ratio of the grid</span>
                  <span class="n">aspect</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                  <span class="c1"># Declare whether we want common y-axes</span>
                  <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span>
          <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
          <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="c1">#optionally set marker size</span>
          <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span> <span class="c1">#optionally fix marker color</span>
         <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Starting from the left-hand side, each <code class="docutils literal notranslate"><span class="pre">x</span></code> point represents a sensor reading. The white background in the grey bars environment shows as 100 and the solid black line shows as 0.</p>
</div>
</div>
<div class="section" id="summary">
<h2>4.7 Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>In this notebook, you have seen how to preview sensor values using the <em>Instrumentation</em> panel, as well as using variables to refer to sensor values and use them to identify when to break out of an otherwise infinite <code class="docutils literal notranslate"><span class="pre">while</span></code> loop.</p>
<p>You have reviewed the capabilities of the light sensor, including its ability to report reflected, three-component RGB (red, green, blue) colour values and even colour names.</p>
<p>You have also seen how we can view sensor data in real time as it is collected using the simulator <em>Chart</em> view, or download the logged data to the notebook’s own Python environment. With the data downloaded to the notebook, we can visualise it at our leisure in an ‘offline’ way using powerful Python statistical and scientific charting packages such as <code class="docutils literal notranslate"><span class="pre">seaborn</span></code>.</p>
<p><em>This completes the practical activities for this week.</em></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./02. Getting started with robot and Python programming"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="02.3%20General%20programming%20concepts.html" title="previous page">3.1 Constants and variables in programs</a>
    <a class='right-next' id="next-link" href="../03.%20Controlling%20program%20execution%20flow/03.1%20Program%20control%20using%20for%20loops.html" title="next page">1 Introduction to program control flow</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>